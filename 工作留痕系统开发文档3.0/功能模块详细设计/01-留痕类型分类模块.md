# 留痕类型分类模块详细设计

> 创建时间：2025-04-10 09:42:13
> 创建者：绣花针项目开发团队
> 文档版本：1.0.0

## 1. 模块概述

留痕类型分类模块是工作留痕系统的核心入口，负责提供不同类型的工作留痕方式，满足不同场景下的记录需求。本模块将工作留痕分为文章型留痕和事迹型留痕两种主要形式，并提供相关的功能支持。

### 1.1 设计目标

- 为用户提供直观的留痕类型选择界面
- 满足不同工作场景下的记录需求
- 降低用户记录工作的门槛
- 优化内容分类与检索效率
- 提升用户体验与工作效率

### 1.2 核心功能

- 文章型留痕（带标题的正式内容）
- 事迹型留痕（无标题的简短记录）
- 位置信息自动附加
- 快速分享与责任人标记
- 分类标签管理

## 2. 功能点详细说明

| 功能点ID | 功能名称 | 功能描述 | 优先级 | 技术可行性 |
|---------|---------|---------|-------|-----------|
| F-TC-001 | 文章型留痕 | 提供带标题、章节结构的正式内容记录方式 | P0 | 高 |
| F-TC-002 | 事迹型留痕 | 提供无标题、简短快速的工作片段记录方式 | P0 | 高 |
| F-TC-003 | 位置信息附加 | 自动采集和关联位置信息，支持地理标记 | P1 | 高 |
| F-TC-004 | 责任人标记 | 快速标记相关责任人，支持通知和分享 | P1 | 高 |
| F-TC-005 | 分类标签管理 | 支持预设和自定义标签，多维度分类 | P0 | 高 |
| F-TC-006 | 自动目录生成 | 为文章型留痕自动生成内容目录 | P2 | 高 |
| F-TC-007 | 历史类型记忆 | 记忆用户偏好的留痕类型和使用习惯 | P2 | 高 |
| F-TC-008 | 使用引导 | 为新用户提供功能引导和提示 | P1 | 高 |

### 2.1 文章型留痕（F-TC-001）

#### 功能描述

文章型留痕适用于需要结构化、正式记录的工作场景，如会议纪要、工作总结、项目报告等。具有标题、章节结构、格式化内容等特点。

#### 关键特性

- 标题与副标题设置
- 章节结构支持
- 富文本格式化
- 附件关联
- 正式模板应用

#### 实现要点

- 使用自定义组件实现富文本编辑器
- 支持多种格式化选项（标题、列表、引用等）
- 实现模板选择和应用功能
- 提供清晰的文档结构预览

### 2.2 事迹型留痕（F-TC-002）

#### 功能描述

事迹型留痕适用于快速记录、简短内容的工作场景，如工作随记、进度更新、问题记录等。强调简洁性和便捷性。

#### 关键特性

- 无需标题，直接内容输入
- 支持快速照片附加
- 简化的格式选项
- 快速发布流程
- 时间轴式展示

#### 实现要点

- 优化输入流程，减少操作步骤
- 提供一键拍照并关联功能
- 自动保存和断点继续编辑
- 适应移动场景下的快速录入

### 2.3 位置信息附加（F-TC-003）

#### 功能描述

自动采集用户当前位置信息，关联到工作记录中，支持地理位置标记和轨迹记录。

#### 关键特性

- 自动位置检测和关联
- 位置信息展示（地图、地址文本）
- 位置记录开关控制
- 位置历史管理

#### 实现要点

- 使用微信位置API (wx.getLocation)
- 整合地图组件展示位置信息
- 实现位置信息脱敏处理
- 处理位置权限请求和降级方案

### 2.4 责任人标记（F-TC-004）

#### 功能描述

允许用户快速标记与工作记录相关的责任人，支持通知和分享功能。

#### 关键特性

- 联系人选择界面
- 多人标记支持
- 责任类型定义（知会、协办、主办等）
- 一键分享和通知

#### 实现要点

- 利用开放数据域获取用户列表
- 实现用户搜索和快速选择
- 集成订阅消息通知功能
- 处理跨用户数据隐私问题

### 2.5 分类标签管理（F-TC-005）

#### 功能描述

为工作记录提供多维度的分类标签，支持预设标签和用户自定义标签。

#### 关键特性

- 标签创建、编辑和删除
- 标签分组和层级管理
- 标签推荐和智能匹配
- 基于标签的内容检索

#### 实现要点

- 设计高效的标签数据结构
- 实现标签缓存和同步机制
- 支持标签组织和优先级排序
- 开发标签智能推荐算法

## 3. 组件设计

### 3.1 组件架构

```
┌───────────────────────────────────────────────────┐
│                 留痕类型分类模块                   │
│  ┌───────────────┐         ┌───────────────────┐  │
│  │ 类型选择容器  │         │ 分类标签管理组件  │  │
│  └───────────────┘         └───────────────────┘  │
│          │                           │            │
│  ┌───────▼───────┐         ┌─────────▼─────────┐  │
│  │ 文章型留痕组件│         │ 位置信息组件      │  │
│  └───────────────┘         └───────────────────┘  │
│          │                           │            │
│  ┌───────▼───────┐         ┌─────────▼─────────┐  │
│  │ 事迹型留痕组件│         │ 责任人标记组件    │  │
│  └───────────────┘         └───────────────────┘  │
└───────────────────────────────────────────────────┘
```

### 3.2 核心组件说明

#### TypeSelectionContainer（类型选择容器）

- **职责**：提供留痕类型的选择界面，管理类型切换
- **接口**：
  - `switchType(type: string): void` - 切换留痕类型
  - `getCurrentType(): string` - 获取当前选择的类型
  - `onTypeChange: Event` - 类型变更事件

#### ArticleTraceComponent（文章型留痕组件）

- **职责**：实现文章型留痕的UI和基础功能
- **接口**：
  - `initWithTemplate(templateId: string): void` - 使用模板初始化
  - `getArticleData(): ArticleData` - 获取文章数据
  - `validate(): boolean` - 验证文章数据有效性

#### EventTraceComponent（事迹型留痕组件）

- **职责**：实现事迹型留痕的UI和基础功能
- **接口**：
  - `quickCapture(): void` - 快速采集内容
  - `getEventData(): EventData` - 获取事迹数据
  - `validate(): boolean` - 验证事迹数据有效性

#### LocationComponent（位置信息组件）

- **职责**：管理位置信息的获取、显示和关联
- **接口**：
  - `getCurrentLocation(): Promise<LocationData>` - 获取当前位置
  - `toggleLocationService(enable: boolean): void` - 开关位置服务
  - `renderLocationView(): void` - 渲染位置信息视图

#### ResponsiblePersonComponent（责任人标记组件）

- **职责**：管理责任人的选择、标记和通知
- **接口**：
  - `selectUsers(): Promise<UserList>` - 选择用户
  - `addResponsibility(userId: string, type: string): void` - 添加责任类型
  - `notifyUsers(): Promise<boolean>` - 通知相关用户

#### TagManagerComponent（分类标签管理组件）

- **职责**：管理标签的创建、使用和组织
- **接口**：
  - `addTag(name: string, group?: string): Tag` - 添加标签
  - `getRecommendedTags(): Tag[]` - 获取推荐标签
  - `searchTags(keyword: string): Tag[]` - 搜索标签

## 4. 界面设计

### 4.1 类型选择界面

```
┌──────────────────────────────────────────┐
│              工作留痕                    │
├──────────────────────────────────────────┤
│                                          │
│  ┌───────────────┐  ┌───────────────┐    │
│  │   文章型      │  │    事迹型     │    │
│  │  (带标题)     │  │   (无标题)    │    │
│  │               │  │               │    │
│  │   [图标]      │  │    [图标]     │    │
│  │               │  │               │    │
│  │  适合正式记录  │  │  适合快速记录  │    │
│  └───────────────┘  └───────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │         最近使用的类型           │    │
│  │                                  │    │
│  │  [最近项目1]    [最近项目2]      │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │            快速操作              │    │
│  │                                  │    │
│  │  [一键拍照]    [语音记录]        │    │
│  └──────────────────────────────────┘    │
└──────────────────────────────────────────┘
```

### 4.2 文章型留痕界面

```
┌──────────────────────────────────────────┐
│ ← 返回    文章型留痕        [保存] [发布]│
├──────────────────────────────────────────┤
│  ┌──────────────────────────────────┐    │
│  │ 标题: [输入文章标题...]          │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 正文:                            │    │
│  │                                  │    │
│  │ [富文本编辑区域...]              │    │
│  │                                  │    │
│  │                                  │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 附件: [+] [照片] [文件] [语音]   │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 标签: [添加标签] [推荐标签...]   │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 位置: [当前位置] [更改]          │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 相关人员: [添加] [已选: 0]       │    │
│  └──────────────────────────────────┘    │
└──────────────────────────────────────────┘
```

### 4.3 事迹型留痕界面

```
┌──────────────────────────────────────────┐
│ ← 返回    事迹型留痕        [保存] [发布]│
├──────────────────────────────────────────┤
│  ┌──────────────────────────────────┐    │
│  │ [直接输入内容...]                │    │
│  │                                  │    │
│  │                                  │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ [照片区域]     [+] [拍照]        │    │
│  │                                  │    │
│  │                                  │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 快速工具:                        │    │
│  │ [语音] [标签] [位置] [责任人]    │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 常用模板:                        │    │
│  │ [日报] [问题] [进度] [其他]      │    │
│  └──────────────────────────────────┘    │
└──────────────────────────────────────────┘
```

### 4.4 标签管理界面

```
┌──────────────────────────────────────────┐
│ ← 返回    标签管理             [完成]    │
├──────────────────────────────────────────┤
│  ┌──────────────────────────────────┐    │
│  │ 搜索: [搜索标签...]              │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 已选标签:                        │    │
│  │ [标签1] [标签2] [标签3]          │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 推荐标签:                        │    │
│  │ [推荐1] [推荐2] [推荐3] [推荐4]  │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ 标签分组:                        │    │
│  │ • 项目类 [标签...] [更多]        │    │
│  │ • 工作类 [标签...] [更多]        │    │
│  │ • 自定义 [标签...] [更多]        │    │
│  └──────────────────────────────────┘    │
│                                          │
│  ┌──────────────────────────────────┐    │
│  │ [+ 创建新标签]                   │    │
│  └──────────────────────────────────┘    │
└──────────────────────────────────────────┘
```

## 5. 交互流程

### 5.1 留痕类型选择流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  进入应用   │────►│ 显示类型选择│────►│ 用户选择类型│
└─────────────┘     └─────────────┘     └──────┬──────┘
                                                │
                                                ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 进入编辑界面│◄────│ 初始化相应  │◄────│ 加载类型配置│
└─────────────┘     │ 类型组件    │     └─────────────┘
```

### 5.2 文章型留痕创建流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 进入文章型  │────►│ 填写标题和  │────►│ 添加附件和  │
│ 留痕界面    │     │ 正文内容    │     │ 标签        │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                                │
                                                ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 完成创建    │◄────│ 预览和编辑  │◄────│ 添加位置和  │
└─────────────┘     └─────────────┘     │ 相关人员    │
                                        └─────────────┘
```

### 5.3 事迹型留痕创建流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 进入事迹型  │────►│ 直接输入内容│────►│ 添加照片    │
│ 留痕界面    │     │             │     │             │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                                │
                                                ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 完成创建    │◄────│ 快速预览    │◄────│ 添加位置和  │
└─────────────┘     └─────────────┘     │ 标签        │
                                        └─────────────┘
```

### 5.4 标签管理流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 打开标签    │────►│ 显示现有标签│────►│ 搜索或选择  │
│ 管理界面    │     │             │     │ 标签        │
└─────────────┘     └─────────────┘     └──────┬──────┘
                                                │
                                                ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 应用所选标签│◄────│ 确认标签选择│◄────│ 创建新标签  │
└─────────────┘     └─────────────┘     │ (可选)      │
                                        └─────────────┘
```

## 6. 业务规则

1. **类型默认值**：
   - 新用户首次使用时默认显示事迹型留痕（简单模式）
   - 再次使用时优先显示上次使用的类型

2. **必填信息规则**：
   - 文章型留痕：标题为必填，内容至少10个字符
   - 事迹型留痕：内容必填，至少1个字符

3. **位置信息规则**：
   - 默认自动采集位置信息
   - 用户可手动关闭位置采集
   - 位置信息精度默认为区县级

4. **标签使用规则**：
   - 每条记录最多可添加10个标签
   - 推荐标签基于用户历史使用频率生成
   - 自定义标签在使用3次后转为常用标签

5. **责任人规则**：
   - 每条记录最多可关联20个责任人
   - 责任类型包括：知会、协办、主办三种类型
   - 默认责任类型为"知会"

## 7. 数据模型

### 7.1 留痕类型配置

```typescript
interface TraceTypeConfig {
  id: string;                  // 类型ID
  name: string;                // 类型名称
  description: string;         // 类型描述
  icon: string;                // 类型图标
  componentName: string;       // 对应组件名称
  defaultTemplate?: string;    // 默认模板ID
  features: string[];          // 支持的功能列表
}
```

### 7.2 文章型留痕数据

```typescript
interface ArticleTraceData {
  id: string;                  // 记录ID
  title: string;               // 文章标题
  subtitle?: string;           // 副标题（可选）
  content: string;             // 富文本内容
  attachments: Attachment[];   // 附件列表
  tags: Tag[];                 // 标签列表
  location?: LocationInfo;     // 位置信息
  responsiblePersons: User[];  // 责任人列表
  createTime: number;          // 创建时间
  updateTime: number;          // 更新时间
  status: string;              // 状态
}
```

### 7.3 事迹型留痕数据

```typescript
interface EventTraceData {
  id: string;                  // 记录ID
  content: string;             // 文本内容
  photos: Photo[];             // 照片列表
  tags: Tag[];                 // 标签列表
  location?: LocationInfo;     // 位置信息
  responsiblePersons: User[];  // 责任人列表
  createTime: number;          // 创建时间
  updateTime: number;          // 更新时间
  status: string;              // 状态
}
```

### 7.4 标签数据

```typescript
interface Tag {
  id: string;                  // 标签ID
  name: string;                // 标签名称
  groupId?: string;            // 分组ID（可选）
  color?: string;              // 标签颜色（可选）
  count: number;               // 使用次数
  isPreset: boolean;           // 是否预设标签
  createTime: number;          // 创建时间
}
```

### 7.5 位置信息数据

```typescript
interface LocationInfo {
  latitude: number;            // 纬度
  longitude: number;           // 经度
  accuracy: number;            // 精度
  address: string;             // 地址文本
  name?: string;               // 位置名称（可选）
  time: number;                // 采集时间
}
```

## 8. 异常处理

### 8.1 位置信息获取失败

- **场景**：用户拒绝位置权限或位置获取失败
- **处理**：
  - 显示友好提示，解释位置信息的用途
  - 提供手动输入位置的选项
  - 记录用户的权限选择，避免频繁请求

### 8.2 内容保存失败

- **场景**：网络异常或存储空间不足导致保存失败
- **处理**：
  - 自动保存到本地缓存
  - 显示离线工作提示
  - 网络恢复后自动尝试同步

### 8.3 责任人选择失败

- **场景**：获取用户列表失败或用户拒绝授权
- **处理**：
  - 提供手动输入用户信息的选项
  - 缓存常用联系人列表
  - 优雅降级为基础联系人功能

## 9. 性能优化措施

1. **延迟加载**：
   - 标签列表和用户列表采用延迟加载
   - 图片资源按需加载和缓存

2. **数据缓存**：
   - 缓存常用标签和最近使用的模板
   - 用户偏好设置本地存储

3. **UI优化**：
   - 减少重绘和重排操作
   - 使用虚拟滚动处理长列表

4. **网络优化**：
   - 数据预取和批量请求
   - 增量更新和差异传输

## 10. 测试要点

### 10.1 功能测试

- 验证不同留痕类型的创建流程
- 测试标签的添加、编辑和删除功能
- 验证位置信息的采集和显示
- 测试责任人的选择和通知功能

### 10.2 边界测试

- 测试极长文本内容的处理
- 验证大量标签的性能表现
- 测试多设备同步场景
- 验证离线使用场景

### 10.3 兼容性测试

- 不同屏幕尺寸的适配性
- 不同微信版本的兼容性
- 低端设备的性能表现

## 11. 注意事项和限制

1. **微信小程序限制**：
   - 位置权限需要用户授权
   - 用户列表获取受开放数据域限制
   - 本地存储空间限制为10MB

2. **业务规则约束**：
   - 标签管理需考虑多人协作场景
   - 责任人通知需遵循消息推送规范
   - 内容编辑需支持草稿保存和断点续编

3. **性能考量**：
   - 富文本编辑器在低端设备可能性能不佳
   - 大量照片处理可能影响应用性能
   - 需平衡在线功能和离线可用性

---

## 文档更新记录

| 版本号 | 更新日期 | 更新人 | 更新内容 |
|-------|---------|-------|---------|
| 1.0.0 | 2025-04-10 09:42:13 | 绣花针项目组 | 初始版本创建 |

---

© 2025 绣花针项目组 - 保密文档 