# 数据同步框架2.0 - 问题收集

> **最后更新**: 2025-04-09 16:45

## 使用说明

本文档用于收集开发过程中遇到的所有问题、疑惑和待查询事项。不同于问题日志(记录已发现并解决的问题)，本文档侧重于:
- 尚未确定解决方案的问题
- 需要进一步调研的技术点
- 潜在的风险和担忧
- 需要澄清的需求或规范

每个问题应包含问题描述、影响范围、优先级和当前状态。

## 待解决问题

### Q-001: 微信小程序环境下Promise实现的兼容性 (2025-04-03)

**问题描述**:
微信小程序环境对ES6 Promise的支持存在一定限制，特别是在低版本基础库下。如何确保同步框架在所有目标环境中可靠运行？

**影响范围**:
- 异步操作处理
- 所有使用Promise的组件
- 可能影响框架整体兼容性

**优先级**: 高

**当前状态**:
- 初步调研了小程序基础库对Promise的支持情况
- 考虑使用Promise polyfill，但担心增加额外代码体积
- 需进一步测试在低端设备和低版本基础库下的表现

**待解决事项**:
- 确定最低支持的基础库版本
- 测试Promise polyfill在各种环境下的性能
- 评估是否需要开发自定义的异步处理方案

### Q-002: 大规模数据集的性能测试方法 (2025-04-05)

**问题描述**:
如何有效测试框架在处理大规模数据集(5000+条记录)时的性能表现？现有的测试环境和方法可能无法模拟真实的大数据量场景。

**影响范围**:
- 性能测试
- 大数据量优化
- 可能影响实际应用中的用户体验

**优先级**: 中

**当前状态**:
- 已开发基础的性能测试框架
- 可以测试小型数据集的同步性能
- 尚未建立大规模数据的测试方法

**待解决事项**:
- 开发大数据量生成工具
- 设计渐进式数据量测试方案
- 确定大数据量测试的关键指标

### Q-003: 敏感数据同步的安全策略 (2025-04-06)

**问题描述**:
框架需要同步的数据中可能包含敏感信息(如个人信息、位置数据等)，如何确保这些数据在同步过程中的安全性？

**影响范围**:
- 数据传输安全
- 本地存储安全
- 合规性要求

**优先级**: 高

**当前状态**:
- 已实现基本的HTTPS传输
- 考虑增加数据加密机制
- 需要明确敏感数据的具体类型和处理要求

**待解决事项**:
- 调研适合小程序环境的轻量级加密方案
- 定义敏感数据处理规范
- 设计安全审计机制

### Q-004: 不同业务场景的优化策略差异 (2025-04-07)

**问题描述**:
不同业务场景(如表单数据、媒体文件、实时协作等)对同步性能和策略的需求差异很大，如何使框架能够灵活适应这些差异？

**影响范围**:
- 同步策略设计
- 性能优化
- 框架适用范围

**优先级**: 中

**当前状态**:
- 框架当前采用通用的同步策略
- 考虑引入场景化配置
- 需要收集更多业务场景的具体需求

**待解决事项**:
- 调研典型业务场景的同步特点
- 设计场景化配置机制
- 评估自适应策略的可行性

### Q-005: WebSocket在小程序环境中的稳定性 (2025-04-08)

**问题描述**:
考虑使用WebSocket实现实时同步功能，但担心在小程序环境(特别是在弱网环境)下的稳定性和性能问题。

**影响范围**:
- 实时同步功能
- 网络资源占用
- 弱网环境适配

**优先级**: 低

**当前状态**:
- 初步评估了WebSocket方案
- 关注到微信小程序对WebSocket连接数有限制
- 担心长连接在弱网环境下的稳定性

**待解决事项**:
- 测试WebSocket在各种网络条件下的表现
- 研究断线重连和心跳机制的实现
- 评估WebSocket与轮询方案的资源占用对比

## 技术调研需求

### R-001: IndexedDB在小程序环境中的替代方案

**调研目的**:
考虑使用类似IndexedDB的结构化数据存储方案，提升大数据量查询效率，需要调研小程序环境下的可行替代方案。

**关键问题**:
- 小程序是否有类似IndexedDB的存储API？
- 如何实现高效的结构化数据查询？
- 有无成熟的第三方解决方案？

**优先级**: 中

### R-002: 微信小程序环境下可靠的定时任务机制

**调研目的**:
需要实现稳定的后台同步任务，但小程序的生命周期管理可能影响定时任务的可靠执行。

**关键问题**:
- 小程序后台运行时间限制是多少？
- 有何可靠的后台任务调度方法？
- 如何处理应用切入后台后的同步任务？

**优先级**: 高

### R-003: 小程序环境下的数据压缩算法效率对比

**调研目的**:
为减少同步数据传输量和存储空间占用，需要评估各种数据压缩算法在小程序环境下的效率和适用性。

**关键问题**:
- 哪些压缩算法适合在小程序JS环境运行？
- 各算法在压缩率和性能上的对比如何？
- 有无现成的小程序压缩库可用？

**优先级**: 中

## 需求澄清

### C-001: 离线数据优先级规则

**需求描述**:
规范中提到了"根据数据重要性设定同步优先级"，但未明确定义如何判断数据重要性和具体的优先级等级。

**待澄清内容**:
- 数据重要性的判定标准是什么？
- 需要设置几个优先级等级？
- 是否需要支持业务层动态调整优先级？

**影响范围**:
- 同步调度算法
- 离线数据管理策略

### C-002: 框架性能验收标准细则

**需求描述**:
验收标准中规定了多项性能指标，但部分指标缺乏明确的测试环境和条件说明。

**待澄清内容**:
- "弱网环境"的具体定义和参数(延迟、丢包率等)
- 大数据量测试的具体记录数量和数据结构
- 性能指标的测试设备标准配置

**影响范围**:
- 性能测试方案
- 优化目标设定 