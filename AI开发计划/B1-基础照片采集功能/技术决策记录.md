# B1: 基础照片采集功能 - 技术决策记录

## 决策记录列表

| 决策ID | 决策标题 | 状态 | 日期 | 决策者 |
|-------|---------|------|------|-------|
| B1-D1 | 使用camera-manager组件封装相机功能 | 已确认 | 2023-10-18 | AI开发团队 |
| B1-D2 | 使用swiper组件实现照片预览 | 已确认 | 2023-10-18 | AI开发团队 |
| B1-D3 | 拍照图片存储机制选择 | 已确认 | 2023-10-18 | AI开发团队 |
| B1-D4 | 照片压缩处理方案 | 待评估 | - | AI开发团队 |

## 详细决策记录

### B1-D1: 使用camera-manager组件封装相机功能

#### 背景
微信小程序提供了基础的camera组件，但原生组件使用存在一定限制，需要封装以便统一处理拍照逻辑、权限管理和错误处理。

#### 方案对比

| 方案 | 优势 | 劣势 | 复杂度 |
|-----|------|------|-------|
| 直接使用原生camera | 开发简单，性能最佳 | 各页面需重复处理权限和错误 | 低 |
| 封装camera-manager组件 | 统一处理权限和错误，代码复用性高 | 增加抽象层，调试略复杂 | 中 |
| 使用第三方相机组件 | 功能可能更丰富 | 依赖外部代码，可能有兼容性问题 | 高 |

#### 决策理由
选择封装camera-manager组件方案，主要基于以下考虑：
1. 提高代码复用性，避免多个页面重复编写相机处理逻辑
2. 统一处理相机权限申请和错误处理，提高用户体验
3. 便于后续功能扩展，如增加滤镜、美颜等功能
4. 自主实现，避免第三方组件带来的不确定性

#### 实施计划
1. 创建camera-manager组件，封装基础拍照功能
2. 实现权限管理和错误处理逻辑
3. 提供简洁的API接口供页面调用
4. 完善文档和使用示例

---

### B1-D2: 使用swiper组件实现照片预览

#### 背景
拍摄多张照片后，需要提供预览和管理功能，允许用户查看、删除和使用照片。

#### 方案对比

| 方案 | 优势 | 劣势 | 复杂度 |
|-----|------|------|-------|
| 使用swiper组件 | 原生组件，性能好，支持滑动切换 | 自定义样式稍受限制 | 低 |
| 自定义预览组件 | 高度自定义，可实现更多动效 | 需自行处理手势和过渡效果，工作量大 | 高 |
| 单图预览+列表 | 实现简单，操作直观 | 用户体验较差，无法流畅切换 | 低 |

#### 决策理由
选择使用swiper组件实现照片预览，主要基于以下考虑：
1. 微信原生组件，性能优秀，流畅度高
2. 内置滑动切换效果，符合用户使用习惯
3. 开发工作量适中，能快速实现核心功能
4. 后续可通过样式优化提升视觉效果

#### 实施计划
1. 使用swiper组件构建基础预览界面
2. 添加自定义控制按钮（删除、保存、使用等）
3. 实现预览模式与拍摄模式的切换
4. 优化切换动画和交互体验

---

### B1-D3: 拍照图片存储机制选择

#### 背景
照片拍摄后需要临时存储以供预览和后续使用，需要选择合适的存储机制。

#### 方案对比

| 方案 | 优势 | 劣势 | 复杂度 |
|-----|------|------|-------|
| 内存中临时存储 | 速度最快，使用简单 | 内存占用大，小程序重启后丢失 | 低 |
| 本地存储+临时路径 | 速度较快，重启后仍可恢复 | 存储空间有限，需管理临时文件 | 中 |
| 直接上传云存储 | 节省本地空间，数据更安全 | 依赖网络，交互延迟高 | 高 |

#### 决策理由
选择"本地存储+临时路径"方案，主要基于以下考虑：
1. 平衡了性能和可靠性，拍照后可立即预览
2. 小程序重启后可恢复已拍摄的照片
3. 避免频繁网络请求，提高用户体验
4. 可控制本地存储大小，预防内存问题

#### 实施计划
1. 拍照后将照片临时路径存储在页面data中
2. 同时将路径信息存储到本地storage
3. 页面加载时检查并恢复已存储的照片
4. 实现存储空间管理，预防存储溢出

---

### B1-D4: 照片压缩处理方案

#### 背景
相机拍摄的照片可能尺寸较大，需要考虑压缩处理以优化存储和传输效率。

#### 方案对比

| 方案 | 优势 | 劣势 | 复杂度 |
|-----|------|------|-------|
| 原图存储，使用时压缩 | 保留最高质量，灵活控制 | 存储空间占用大，处理时可能卡顿 | 中 |
| 拍摄时直接压缩 | 节省存储空间，传输更快 | 可能损失细节，无法恢复原图 | 中 |
| 云端处理压缩 | 降低客户端负担，多种尺寸选择 | 依赖网络，增加传输成本 | 高 |

#### 决策状态
此决策尚在评估中，需要进一步测试不同方案对性能和用户体验的影响。

#### 评估计划
1. 测试不同压缩比例对图片质量的影响
2. 评估压缩处理对性能的影响
3. 考察不同设备对大图片的处理能力
4. 权衡存储空间和图片质量的平衡点

---

## 待解决的技术问题

1. 如何处理大量照片情况下的内存占用问题
2. 相机预览画面在不同机型上的适配方案
3. 如何优化弱网环境下的照片上传体验
4. 高分辨率照片的性能优化策略

---

创建日期: 2023-10-18
最后更新: 2023-10-18 