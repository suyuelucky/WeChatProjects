<!-- 
  åšå®¢æ»‘åŠ¨æ€§èƒ½æµ‹è¯•é¡µé¢WXML
  åˆ›å»ºè€…ï¼šClaudeåŠ©æ‰‹
  åˆ›å»ºæ—¶é—´ï¼š2025å¹´04æœˆ10æ—¥ 21:30:58 
-->

<view class="performance-test-container">
  <view class="test-header">
    <view class="header-title">
      <text class="title">åšå®¢æ»‘åŠ¨æ€§èƒ½æµ‹è¯•</text>
      <text class="subtitle">å·¥ä¸šçº§æç«¯éªŒæ”¶æ ‡å‡†</text>
    </view>
    
    <view class="real-time-metrics" wx:if="{{isTestRunning}}">
      <view class="metric-item">
        <text class="metric-label">FPS</text>
        <text class="metric-value {{currentFps >= 120 ? 'excellent' : currentFps >= 90 ? 'good' : currentFps >= 60 ? 'acceptable' : 'poor'}}">{{currentFps}}</text>
      </view>
      <view class="metric-item">
        <text class="metric-label">å¡é¡¿</text>
        <text class="metric-value {{currentJanks === 0 ? 'excellent' : currentJanks <= 3 ? 'acceptable' : 'poor'}}">{{currentJanks}}</text>
      </view>
    </view>
  </view>
  
  <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
  <view class="test-controls" wx:if="{{!isTestRunning && !showResults}}">
    <view class="control-section">
      <view class="section-title">é€‰æ‹©æµ‹è¯•åœºæ™¯</view>
      <picker bindchange="onScenarioSelect" value="{{selectedScenario}}" range="{{scenarios}}" range-key="name">
        <view class="picker-view">
          <text>å½“å‰é€‰æ‹©: {{scenarios[selectedScenario] ? scenarios[selectedScenario].name : 'è¯·é€‰æ‹©åœºæ™¯'}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      <text class="scenario-description" wx:if="{{selectedScenario}}">
        {{scenarios[selectedScenario].description}}
      </text>
    </view>
    
    <view class="control-section">
      <view class="section-title">æµ‹è¯•å‚æ•°è®¾ç½®</view>
      <view class="test-params">
        <view class="param-item">
          <text class="param-label">æµ‹è¯•æ—¶é•¿:</text>
          <slider 
            min="5" max="30" step="5" 
            value="{{testDuration}}" 
            bindchange="setTestDuration" 
            show-value="true"
            active-color="#07c160"
            block-color="#07c160"
            class="duration-slider"
          />
          <text class="param-value">{{testDuration}}ç§’</text>
        </view>
        
        <view class="param-item">
          <text class="param-label">ç›®æ ‡å¸§ç‡:</text>
          <picker 
            mode="selector" 
            range="{{fpsOptions}}" 
            value="{{fpsIndex}}" 
            bindchange="bindFPSChange"
            class="fps-picker"
          >
            <view class="picker-text">{{targetFPS}}fps</view>
          </picker>
        </view>
      </view>
    </view>
    
    <button class="primary-btn" bindtap="startTest" disabled="{{!selectedScenario}}">å¼€å§‹æµ‹è¯•</button>
  </view>
  
  <!-- æµ‹è¯•è¿›è¡Œä¸­çš„æ•°æ®å±•ç¤º -->
  <view class="test-in-progress" wx:if="{{isTestRunning}}">
    <view class="progress-section">
      <progress class="test-progress" percent="{{testProgress}}" stroke-width="4" activeColor="#3c8dbc" backgroundColor="#f0f0f0" />
      <text class="progress-text">æµ‹è¯•è¿›è¡Œä¸­ {{testProgress}}%</text>
      <text class="scenario-running">æ­£åœ¨æ‰§è¡Œ: {{currentScenario.name}}</text>
    </view>
    
    <!-- é¢„è§ˆå†…å®¹åŒºåŸŸï¼ˆå±•ç¤ºæµ‹è¯•æ•°æ®çš„æ»šåŠ¨åˆ—è¡¨ï¼‰ -->
    <scroll-view 
      class="test-content-preview"
      scroll-y="true"
      bindscroll="onScroll"
      scroll-with-animation="{{true}}"
      enhanced="{{true}}"
      bounces="{{true}}"
      show-scrollbar="{{true}}"
      fast-deceleration="{{true}}"
    >
      <view class="waterfall">
        <view class="waterfall-column">
          <block wx:for="{{testData}}" wx:key="id" wx:if="{{index % 2 === 0}}">
            <view class="test-blog-card">
              <!-- ä½œè€…ä¿¡æ¯ -->
              <view class="blog-author">
                <image class="author-avatar" src="{{item.author.avatarUrl}}" mode="aspectFill"></image>
                <text class="author-name">{{item.author.nickname}}</text>
                <text class="blog-time">{{item.createTime}}</text>
              </view>
              
              <!-- åšå®¢å†…å®¹ -->
              <view class="blog-content">
                <text class="content-text">{{item.content}}</text>
                
                <!-- å›¾ç‰‡å±•ç¤º -->
                <block wx:if="{{item.images.length > 0}}">
                  <view class="image-container">
                    <image 
                      wx:for="{{item.images}}" 
                      wx:for-item="img" 
                      wx:key="*this" 
                      src="{{img}}" 
                      mode="widthFix" 
                      class="content-image"
                      lazy-load="true"
                    ></image>
                  </view>
                </block>
              </view>
              
              <!-- äº¤äº’æ  -->
              <view class="blog-footer">
                <view class="action-btn">
                  <text class="action-icon">ğŸ‘</text>
                  <text class="count">{{item.likes}}</text>
                </view>
                <view class="action-btn">
                  <text class="action-icon">ğŸ’¬</text>
                  <text class="count">{{item.comments}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
        
        <view class="waterfall-column">
          <block wx:for="{{testData}}" wx:key="id" wx:if="{{index % 2 === 1}}">
            <view class="test-blog-card">
              <!-- ä½œè€…ä¿¡æ¯ -->
              <view class="blog-author">
                <image class="author-avatar" src="{{item.author.avatarUrl}}" mode="aspectFill"></image>
                <text class="author-name">{{item.author.nickname}}</text>
                <text class="blog-time">{{item.createTime}}</text>
              </view>
              
              <!-- åšå®¢å†…å®¹ -->
              <view class="blog-content">
                <text class="content-text">{{item.content}}</text>
                
                <!-- å›¾ç‰‡å±•ç¤º -->
                <block wx:if="{{item.images.length > 0}}">
                  <view class="image-container">
                    <image 
                      wx:for="{{item.images}}" 
                      wx:for-item="img" 
                      wx:key="*this" 
                      src="{{img}}" 
                      mode="widthFix" 
                      class="content-image"
                      lazy-load="true"
                    ></image>
                  </view>
                </block>
              </view>
              
              <!-- äº¤äº’æ  -->
              <view class="blog-footer">
                <view class="action-btn">
                  <text class="action-icon">ğŸ‘</text>
                  <text class="count">{{item.likes}}</text>
                </view>
                <view class="action-btn">
                  <text class="action-icon">ğŸ’¬</text>
                  <text class="count">{{item.comments}}</text>
                </view>
              </view>
            </view>
          </block>
        </view>
      </view>
    </scroll-view>
    
    <button class="secondary-btn" bindtap="stopTest">åœæ­¢æµ‹è¯•</button>
  </view>
  
  <!-- æµ‹è¯•ç»“æœé¡µé¢ -->
  <view class="test-results" wx:if="{{showResults}}">
    <view class="result-header">
      <view class="result-title">æµ‹è¯•ç»“æœ</view>
      <view class="result-overall {{testResult.overallScore >= 90 ? 'good' : testResult.overallScore >= 70 ? 'warning' : 'bad'}}">
        <text class="score-label">æ€»è¯„åˆ†</text>
        <text class="score-value">{{testResult.overallScore}}</text>
      </view>
    </view>
    
    <view class="results-section">
      <view class="section-title">å¸§ç‡æŒ‡æ ‡</view>
      <view class="result-metrics">
        <view class="metric-row">
          <text class="metric-name">å¹³å‡å¸§ç‡</text>
          <text class="metric-value {{testResult.fps.avg >= targetFps ? 'good' : testResult.fps.avg >= 60 ? 'warning' : 'bad'}}">{{testResult.fps.avg}} fps</text>
        </view>
        <view class="metric-row">
          <text class="metric-name">æœ€ä½å¸§ç‡</text>
          <text class="metric-value {{testResult.fps.min >= 60 ? 'good' : testResult.fps.min >= 30 ? 'warning' : 'bad'}}">{{testResult.fps.min}} fps</text>
        </view>
        <view class="metric-row">
          <text class="metric-name">å¡é¡¿å¸§æ•°</text>
          <text class="metric-value {{testResult.fps.jankFrames === 0 ? 'good' : testResult.fps.jankFrames <= 5 ? 'warning' : 'bad'}}">{{testResult.fps.jankFrames}} å¸§</text>
        </view>
        <view class="metric-row">
          <text class="metric-name">å¡é¡¿æ¯”ä¾‹</text>
          <text class="metric-value {{testResult.fps.jankPercentage === '0%' ? 'good' : parseFloat(testResult.fps.jankPercentage) <= 1 ? 'warning' : 'bad'}}">{{testResult.fps.jankPercentage}}</text>
        </view>
      </view>
    </view>
    
    <view class="results-section">
      <view class="section-title">æ¸²æŸ“æŒ‡æ ‡</view>
      <view class="result-metrics">
        <view class="metric-row">
          <text class="metric-name">å¹³å‡å¸§æ—¶é—´</text>
          <text class="metric-value {{parseFloat(testResult.render.avgFrameTime) < 8.33 ? 'good' : parseFloat(testResult.render.avgFrameTime) < 16.67 ? 'warning' : 'bad'}}">{{testResult.render.avgFrameTime}}</text>
        </view>
        <view class="metric-row">
          <text class="metric-name">æ¸²æŸ“é˜»å¡æ—¶é—´</text>
          <text class="metric-value {{parseFloat(testResult.jank.renderBlockTime) === 0 ? 'good' : parseFloat(testResult.jank.renderBlockTime) < 100 ? 'warning' : 'bad'}}">{{testResult.jank.renderBlockTime}}</text>
        </view>
        <view class="metric-row">
          <text class="metric-name">é˜»å¡æ¯”ä¾‹</text>
          <text class="metric-value {{parseFloat(testResult.jank.totalBlocking) === 0 ? 'good' : parseFloat(testResult.jank.totalBlocking) < 5 ? 'warning' : 'bad'}}">{{testResult.jank.totalBlocking}}</text>
        </view>
      </view>
    </view>
    
    <view class="results-section">
      <view class="section-title">éªŒæ”¶ç»“æœ</view>
      <view class="result-conclusion">
        <view class="conclusion-item {{testResult.result.passLevel1 ? 'passed' : 'failed'}}">
          <text class="level-label">åŸºç¡€éªŒæ”¶ (60fps)</text>
          <text class="level-status">{{testResult.result.passLevel1 ? 'é€šè¿‡' : 'æœªé€šè¿‡'}}</text>
        </view>
        <view class="conclusion-item {{testResult.result.passLevel2 ? 'passed' : 'failed'}}">
          <text class="level-label">é«˜çº§éªŒæ”¶ (90fps)</text>
          <text class="level-status">{{testResult.result.passLevel2 ? 'é€šè¿‡' : 'æœªé€šè¿‡'}}</text>
        </view>
        <view class="conclusion-item {{testResult.result.passLevel3 ? 'passed' : 'failed'}}">
          <text class="level-label">æé™éªŒæ”¶ (120fps)</text>
          <text class="level-status">{{testResult.result.passLevel3 ? 'é€šè¿‡' : 'æœªé€šè¿‡'}}</text>
        </view>
      </view>
    </view>
    
    <view class="recommendations">
      <view class="section-title">ä¼˜åŒ–å»ºè®®</view>
      <view class="recommendation-list">
        <block wx:for="{{testResult.result.recommendation}}" wx:key="*this">
          <view class="recommendation-item">{{item}}</view>
        </block>
      </view>
    </view>
    
    <view class="result-actions">
      <button class="secondary-btn" bindtap="backToTests">è¿”å›æµ‹è¯•åˆ—è¡¨</button>
      <button class="primary-btn" bindtap="applyOptimizations">åº”ç”¨ä¼˜åŒ–</button>
    </view>
  </view>
</view> 