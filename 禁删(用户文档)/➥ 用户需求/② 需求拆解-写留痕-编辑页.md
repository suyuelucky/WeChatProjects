# 需求拆解：写留痕 - 编辑页

## 文档信息
- **文档版本**：v1.0.0
- **编制日期**：2025年03月30日
- **状态**：草稿
- **来源**：《用户需求》专章v4.0.0

## 目录
1. 工作留痕系统概述
2. 留痕类型分类
3. 照片采集与管理
4. 文字录入与编辑
5. 内容处理与发布

## 1. 工作留痕系统概述

工作留痕系统是绣花针平台的核心功能，旨在提供直观、高效的工作记录方式，实现"拍照即留痕，说话即记录"的便捷体验。系统通过优化信息采集、编辑和发布流程，显著提升基层工作效率。

工作留痕编辑页是用户记录工作内容的主要界面，整合了照片采集、语音转文字、富文本编辑等多种功能，使基层工作人员能够快速、高效地记录工作过程和成果。编辑页的设计着重强调了便捷性、智能化和专业性，适应各种工作场景的需求。

## 2. 留痕类型分类

工作留痕系统支持两种不同类型的内容记录模式，满足不同工作场景的需求：

### 2.1 文章型留痕

- **结构特点**：
  - 带有明确标题的正式内容，类似博客形式
  - 包含多张照片和相对完整的文字说明
  - 支持结构化展示和格式化内容（表格、图表等）
  
- **应用场景**：
  - 工作总结、专项报告、调研记录
  - 重要活动记录、经验分享
  - 需正式归档的工作内容
  
- **功能特性**：
  - 支持丰富的文本格式设置（标题、段落、列表等）
  - 提供多种照片与文字排版模式
  - 可导入外部文档（Excel、Markdown等）
  - 自动生成目录和关键词索引
  - 也可以不设标题直接发布
  
- **场景示例**：
  街道干部李明完成为期两周的创城检查工作，需要整理一篇总结报告。他选择"文章型留痕"，拍摄了各个点位的整改前后对比照片，录入详细说明，添加改进建议，形成一篇完整的创城工作总结，便于上级部门查阅和评估。邻导阅后大喜，直呼"好文笔"，一拍大腿，李明连升三级！

### 2.2 事迹型留痕

- **结构特点**：
  - 无需标题的简短记录，类似微博形式
  - 包含少量照片（1-9张）和简短文字说明
  - 也支持结构化展示和格式化内容（表格、图表等）
  - 强调即时性和直观性
  
- **应用场景**：
  - 日常巡查记录
  - 临时发现的问题记录
  - 需快速分享的工作片段
  
- **功能特性**：
  - 拍照后可直接添加简短说明
  - 支持快速分享给责任人
  - 位置信息自动附加
  - 提供快速分类标签
  
- **场景示例**：
  社区网格员王芳在日常巡查中发现小区垃圾桶旁有杂物堆积，她立即打开绣花针应用，选择"事迹型留痕"，拍摄现场照片，对手机说了一段话："某小区3号楼垃圾桶旁杂物堆积，需及时清理"，系统自动转为文字，一键提交，系统智能分配给物业负责人，同时系统抄送了一份给社区网格员及专干，全过程不到30秒。 

## 3. 照片采集与管理

编辑页面中的照片采集与管理功能为工作留痕提供了高效的图像记录能力，通过便捷的拍照机制和智能的照片处理技术，大幅提升了现场记录的效率和质量。

### 3.1 快捷拍照机制

- **全局拍照入口**：
  - 应用任何界面右下角常驻拍照图标，一键启动拍照功能
  - 支持从系统通知栏快速进入拍照界面
  - 可设置应用启动时默认进入拍照模式

- **拍照模式选择**：
  - **单拍模式**：拍一张即返回编辑界面，适合精确记录
  - **连拍模式**：持续拍摄直至用户主动结束，适合快速记录多个场景
  - **定时拍摄**：设定间隔时间自动拍摄，适合记录过程变化

- **相机程序选择**：
  - 支持设置默认调用的相机程序（系统相机或第三方相机）
  - 记忆上次选择，减少重复操作
  - 根据场景智能推荐最适合的相机应用

- **拍摄反馈定制**：
  - 可自定义拍照声音（包括静音选项）
  - 支持拍照时震动反馈，强度可调
  - 拍照成功后有明确的视觉反馈
  - 上述设置可在用户偏好中心统一管理

- **场景示例**：
  网格员李明正在巡查社区，发现多处需要记录的问题。他打开绣花针应用，点击右下角常驻的拍照图标，选择连拍模式，依次拍摄各个问题点，拍摄过程中手机轻微震动提供触觉反馈。拍完后点击"完成"，所有照片自动排列在编辑界面。为了防止遗忘，李明分别按住每一张照片，口述了一段信息，照片从此就有了标记。

### 3.2 照片智能处理

- **自动排列布局**：
  - 拍摄的照片自动以每行三张的网格形式排列在编辑界面开头
  - 支持不同的照片布局模式（网格、列表、幻灯片等）
  - 照片尺寸自动适配屏幕，确保最佳显示效果

- **照片分类存储**：
  - 根据工作需要自动生成两个版本的照片：
    1. 原始版本：不带任何附加信息
    2. 工作版本：带有时间戳、地理位置等工作必要信息
  - 用户可选择使用哪个版本或同时使用两个版本
  - 信息附加方式可自定义（水印位置、大小、透明度等）

- **照片编辑功能**：
  - 基础编辑：裁剪、旋转、亮度/对比度调整
  - 标注功能：支持在照片上添加箭头、圆圈等标注
  - 马赛克处理：
    - 对敏感信息（如人脸、车牌、门牌号）进行马赛克处理
    - 提供人工指定和AI自动识别两种马赛克模式
    - 马赛克颗粒度和透明度可调节，平衡隐私保护和图片可读性
    - 支持一键处理多张照片中的敏感信息，提高工作效率
  - 编辑历史记录：支持撤销/重做操作

- **智能存储优化**：
  - 自动压缩技术，在保证清晰度的前提下优化存储空间
  - 本地与云端智能同步，减轻设备存储负担
  - "用完即删"机制，减轻设备负担，例如滑动页面过程中，使用动态加载、按需加载、虚拟表格、列表等技术，滑出可见区的部分自动清缓存

- **场景示例**：
  社区工作人员李华在创城检查中拍摄了10多张环境问题照片，系统自动将这些照片排列为每行三张的网格布局。他需要突出问题位置，便点击其中一张照片进入编辑模式，添加红色箭头指向垃圾堆积处，并调亮照片使问题更明显。系统自动生成带有拍摄时间和GPS位置的工作版本，同时保留原始版本供存档使用。

### 3.3 照片交互设计

- **长按照片交互**：
  - 长按任何照片触发特效，照片放大显示在屏幕上方
  - 放大过程伴随轻微震动反馈（可在设置中调节或关闭）
  - 其他照片自动半透明化，突出被选中照片
  - 右侧显示麦克风图标，便于直接进行语音描述

- **照片排序调整**：
  - 支持拖拽照片调整顺序，拖动时有轻微放大效果
  - 批量选择多张照片同时调整位置
  - 支持按时间、位置等自动排序
  - 调整后的排序会影响最终生成文档的照片顺序

- **删除操作设计**：
  - 每张照片右上角设有删除按钮（×）
  - 点击删除按钮会同时删除照片及对应文字
  - 删除前有确认弹窗，防止误操作
  - 支持恢复最近删除的内容（30分钟内）

- **封面图设置**：
  - 每张照片左上角设有"设为封面图"标志
  - 最多支持设置三张照片作为封面图
  - 封面图将用于首页、文章列表或分享时的预览
  - 再次点击可取消封面图设置

- **照片合组功能**：
  - 每张照片正上角设有"合组"链接图标，点击后由灰色变为红色或其他显眼色彩
  - 点击其他照片的合组图标时，被点击的照片显示序号1、2、3
  - 最多支持4张照片合为一组
  - 合组照片共用同一份描述信息，排版时这四张图保持在一起，不会被打散
  - 合组状态可通过再次点击图标取消

- **场景示例**：
  街道干部陈军整理社区环境改造成果，他长按其中一张"改造后"照片，照片立即放大并居中显示，同时手机轻微震动提供反馈。他对着麦克风说明情况，再拖动调整照片顺序，将改造前后的照片放在一起形成对比。最后，他点击三张最能代表改造成效的照片左上角图标，将它们设为封面图，这些照片将在分享或首页展示时优先显示。

## 4. 文字录入与编辑

工作留痕编辑页提供了丰富的文字录入与编辑功能，使基层工作人员能够方便地记录和整理工作内容。

### 4.1 语音转文字功能

- **实时语音识别**：
  - 长按照片后点击右侧麦克风图标启动语音录入
  - 语音识别过程中显示动态声波效果，提供直观反馈
  - 语音实时转换为文字，无明显延迟（<0.5秒）
  - 支持长时间不间断录音（最长30分钟）

- **方言识别支持**：
  - 针对全国主要方言优化识别准确率（普通话、粤语、川语等）
  - 自动学习用户口音特点，持续提高识别准确率
  - 方言识别模式可在设置中选择或自动检测
  - 特殊方言可通过离线训练包增强识别能力

- **专业术语识别**：
  - 内置政务、社区工作常用术语库，提高专业词汇识别准确率
  - 支持用户自定义专业词库，适应不同部门专业需求
  - 自动学习用户常用专业术语，持续优化识别效果
  - 针对特定工作场景（如扶贫、创城）提供专用术语包
  - 用户可在个人后台的"个性短语"区域主动新增个性术语、电话、电邮等常用短语或词汇
  - 支持个性短语的分类管理和快速调用
  - 个性短语可设置优先级，提高识别准确率
  - 支持从历史记录中一键添加常用表达为个性短语

- **即时反馈无延迟**：
  - 语音转文字过程实时显示在屏幕上，边说边看
  - 识别结果自动分段，保持良好可读性
  - 支持边录音边修改已转换的文字
  - 在弱网或离线环境下保持高识别率（依靠本地模型）

- **场景示例**：
  民政工作人员刘芳在走访特困户时，拍摄了老人生活环境的照片，长按照片后点击麦克风图标，对着手机详细描述："张大爷今年78岁，属于特困人员救助供养对象，家庭情况比较困难..."。她边说边看屏幕上实时出现的文字，语音识别系统准确捕捉到"特困人员救助供养"等专业术语，即使在农村信号较弱的环境下也能正常工作。

### 4.2 文本编辑功能

- **富文本编辑器**：
  - 提供完整的文本格式设置功能：加粗、斜体、下划线、字号、颜色等
  - 支持段落格式：标题、正文、引用、列表（有序、无序）等
  - 表格插入与编辑功能，支持合并单元格、调整列宽等
  - 支持图文混排，灵活调整图片位置和大小

- **错别字智能修正**：
  - 一键修正按钮，自动识别并修正语音识别产生的错别字
  - 修正准确率不低于95%，支持语境理解
  - 修正时会高亮显示修改处，便于用户确认
  - 支持特定领域专业术语校正，避免误修正专业词汇

- **手动编辑支持**：
  - 支持复制、粘贴、剪切等基本操作
  - 智能输入联想，提高输入效率
  - 支持手写输入，特别适合输入生僻字或特殊符号
  - 手写识别支持多种书写风格，满足不同用户习惯
  - 手写与键盘输入可随时切换，提供灵活的输入方式
  - 编辑过程中自动保存，防止意外丢失

- **格式导入支持**：
  - 支持复制粘贴Excel内容，自动保留表格结构
  - 支持Markdown格式导入，自动转换为对应格式
  - 支持从Word、PDF等文档复制内容，保留基本格式
  - 上传Word/Excel文件后自动解析为编辑器内容

- **场景示例**：
  街道干部王明需要整理一份社区活动总结，他通过语音录入了基本内容后，点击"修正错别字"按钮，系统自动校正了几处语音识别错误。他又添加了活动参与人数和反馈评分的表格，从Excel复制过来后格式完好保留。最后，他对标题使用加粗和大号字体，对重点内容设置不同颜色，使报告更加醒目和条理清晰。

  刘柳接到任务，要向社会公布本单位这一阶段的财务报告，于是他将excel上传进来，表格显示在编辑器内（编辑器可全屏，有全屏按钮），核对数据无误并将几个数据进行涉密处理后，发布，文章页就显示与excel一样的表格，不用另外做表。考虑到只有表格没有说明并不妥，刘干事点击文章页的"编辑"按钮，重回编辑页，他将上头审批过的一份word传上来，提交，文章页就有了文字说明。

### 4.3 图文对应关系

- **一对一关联**：
  - 默认情况下，每张照片对应一段文字说明，形成独立信息单元
  - 照片与文字之间通过视觉元素（如连接线、背景色）明确关联关系
  - 删除照片时可选择是否同时删除对应文字
  - 支持一张照片关联多段文字的高级模式

- **编辑器全屏化**：
  - 支持向上滑动或点击"全屏"按钮，使文本编辑区全屏显示，方便整体性内容编辑
  - 全屏状态下的编辑器仍可使用富文本编辑的全部功能
  - 全屏状态下的文本与各照片对应文字可以互相引用和同步
  - 提供分屏模式，同时显示照片和整体文本

- **多媒体内容支持**：
  - 支持在文本中嵌入表格、图表、外部链接等多媒体内容
  - 提供常用图表模板，一键生成数据可视化内容
  - 支持外部音频内容嵌入，适用于录音记录等场景
  - 支持外部短视频嵌入，丰富内容展现形式

- **场景示例**：
  社区主任张红在整理社区改造项目进展时，为每张工程照片录入了具体说明，形成清晰的一一对应关系。随后她上滑进入整体文本编辑区，添加了项目概述、总体进度等内容，并插入了一张进度图表。在预览时，可以看到每张照片下方显示对应说明，同时整体报告开头有总体介绍，形成完整的项目报告。

## 5. 内容处理与发布

工作留痕系统支持多种内容处理与发布方式，满足不同用户的需求。

### 5.1 提交选项设计

- **临时保存机制**：
  - 编辑过程自动每30秒保存一次草稿
  - 支持手动保存当前编辑进度
  - 切换到其它app时，瞬间自动保存
  - 退出小程序时，瞬间自动保存
  - 失焦时自动保存
  - 意外退出后可恢复上次编辑状态
  - 草稿列表管理，支持多个草稿并行编辑
  - 草稿自动分类，按项目、时间或重要性排序
  - 支持草稿预览、合并、删除等管理操作
  - 草稿可设置提醒，防止重要内容被遗忘
  - 不同设备间草稿同步，确保工作连续性

- **提交方式选择**：
  - 提交前在屏幕底部显示两个选项按钮：
    1. **直接提交**：保留原始记录格式，快速完成提交
    2. **AI帮写**：使用AI技术润色内容，提升专业性
  - 按钮设计醒目，区分明显，防止误触
  - 提供提交前预览功能，确认内容无误

- **导航控制优化**：
  - 界面顶端或底端设置首页、前进、后退、撤销、关闭等导航按钮
  - 自定义导航按钮替代微信小程序默认的前进后退按钮
  - 禁用手指按住屏幕向右滑动时退出小程序的功能，防止意外退出
  - 操作前进行确认提示，避免误操作导致内容丢失

- **直接提交流程**：
  - 点击"直接提交"按钮，系统保留原始记录格式
  - 照片与文字保持原有的对应关系展示
  - 上传速度优先，适合网络条件不佳的环境
  - 提交后显示明确成功反馈，并提供查看入口

- **AI润色功能**：
  - 点击"AI帮写"按钮，系统自动根据长按图片时输入的信息进行分析，进行智能润色：
    1. 优化语言表达，提高专业性
    2. 调整内容结构，增强可读性
    3. 智能排版，美化整体呈现效果
    4. 通过学习，符合该用户的语言习惯特点
  - 润色过程有进度指示，通常在5-10秒内完成
  - 润色结果提供"采用"和"继续修改"选项
  - 支持指定润色风格（如正式报告、简洁记录等，还可提供模板、文风，例如官文文风、新闻报道、游记等，具体可在设置中安排）

- **单位共享配置**：
  - 支持单位级别的通用设置，如工作照片默认使用带时间戳和地理位置的照片
  - 由单位管理员在单位管理后台设置，全员可用
  - 各成员可单独设置个人偏好，也可在设置时点击"应用单位通用设置"
  - 每个设置项可单独设置，也可整体应用单位设置
  - 支持全单位共享的模板和文风，由单位管理员在单位管理平台设置
  - 成员可创建个人模板并推荐或共享给其它人或全单位使用

- **场景示例**：
  街道工作人员陈明完成了一次老旧小区改造走访，记录了5处问题点和居民反馈。他检查内容后犹豫是直接提交还是使用AI润色。考虑到这是向领导汇报的重要内容，他选择了"AI帮写"。系统在8秒内完成润色，将他零散的记录整合为一份结构清晰的报告，包括问题分类、改进建议和后续计划，专业程度大大提升。他满意地点击"采用"并提交。

### 5.2 关键词自动提取

- **智能关键词生成**：
  - 系统自动从每篇内容中（不分文章类或事迹类)提取关键信息，分为四类：
    1. 时间：识别内容中的时间点和时间段
    2. 地点：识别地理位置信息，支持模糊地址识别
    3. 事件：识别主要事件和活动
    4. 人物：识别相关人员和组织
  - 提取过程无需用户干预，在内容提交时自动完成
  - 关键词准确率不低于90%，支持后期手动调整
  - 关键词数量根据内容长度自动调整，通常5-15个
  - 用户可增删改查关键词，并有撤销功能

- **权重可视化展示**：
  - 关键词按重要程度显示不同大小和颜色深浅
  - 形成直观的**关键词云**，重要性一目了然
  - 点击关键词可查看在原文中的位置和上下文
  - 支持自定义关键词云样式和配色

- **关键词动态优化**：
  - 随着数据积累，自动优化关键词提取准确度
  - 定期更新历史内容的关键词，保持一致性
  - 学习用户手动调整的模式，提高个性化准确率
  - 支持部门级词库定制，提高特定领域准确性

- **关键词检索功能**：
  - 点击关键词可快速查看所有包含该关键词的内容
  - 支持关键词组合检索，如"北海公园+创城活动"
  - 检索结果按相关度排序，可切换为时间排序
  - 支持关键词订阅，相关内容更新时获得通知
  - 每个关键词右上标位置都有个圆圈，里面是数字，表示有多少文章含有该关键词
  - 注意，同一篇文章含两个以上相同关键词，也只算"1"个数

- **场景示例**：
  社区工作人员李华提交了一篇关于社区创城活动的工作留痕，系统自动提取关键词：时间（2025年3月15日）、地点（北海公园）、事件（创城宣传）、人物（社区志愿者）等。这些关键词以词云形式直观展示，重要词汇如"创城"字体更大、颜色更深。一个月后，街道需要汇总3月创城工作，工作人员只需点击"创城"关键词，即可看到所有相关工作记录，按相关度排序，大大提高了信息检索效率。在搜索结果页可叠加条件，进一步缩小范围，也可以对着AI说句话，让AI帮忙搜索。

### 5.3 多格式支持

- **复合格式导入**：
  - 支持直接导入各类格式文件：
    1. Excel：自动保留表格结构和数据格式
    2. Markdown：转换为对应的富文本格式
    3. PDF：提取文本和图片，尽可能保留原格式
    4. Word：保留格式、样式和图文排版
  - 导入界面简洁，支持拖拽或选择文件
  - 导入后允许继续编辑和调整内容
  - 提供导入预览，确认效果符合预期

- **格式智能识别**：
  - 自动识别导入内容的原有格式，减少手动排版工作
  - 智能处理表格、列表、标题等复杂结构
  - 自动适配不同屏幕尺寸，优化显示效果
  - 对不支持的复杂格式提供替代方案

- **表格展示支持**：
  - 在工作留痕显示页面完整支持表格、图表等格式化内容
  - 表格支持横向滚动，适应手机屏幕
  - 大型表格提供缩放和定位功能，方便查看
  - 表格数据支持排序和简单筛选功能

- **场景示例**：
  街道干部王刚需要整理一份社区人口统计报告，他已在电脑上用Excel制作了详细的数据表格。在绣花针应用中，他选择"上传"功能导入Excel文件，系统自动识别表格结构并优化显示格式。导入后，他又用语音录入了分析说明，添加了几张现场照片，形成了一份图文并茂、数据详实的完整报告。查看时，即使在手机上也能通过横向滚动和缩放功能轻松浏览复杂的人口数据表格。

## 6. 总结

工作留痕-编辑页是绣花针系统中的核心功能模块，提供了丰富的内容创建和编辑能力，帮助基层工作人员实现"拍照即留痕，说话即记录"的便捷体验。通过优化的照片采集与管理、语音转文字功能、富文本编辑工具、以及智能内容处理与发布机制，大幅提升了基层工作效率，降低了内容记录成本，提高了工作成果的专业性和价值。

编辑页的设计同时关注了不同工作场景的需求，支持从简短即时的事迹型留痕到结构完整的文章型留痕，满足了各类工作记录的需要。其强大的离线工作能力、智能辅助功能和多格式支持，使得基层工作人员能够在各种环境下高效完成工作内容的记录和分享。

## 文档修订记录

| 版本   | 日期          | 修订人 | 修订内容                       |
| ------ | ------------- | ------ | ------------------------------ |
| v1.0.0 | 2025年3月30日 | 项目组 | 初始版本，从《用户需求》专章v4.0.0提取整理 | 