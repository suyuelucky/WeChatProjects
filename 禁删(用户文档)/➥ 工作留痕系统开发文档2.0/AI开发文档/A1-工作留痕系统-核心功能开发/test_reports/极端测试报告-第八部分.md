## 如何运行测试

要运行完整的极端测试套件，只需执行主测试文件：

```javascript
require('./tests/自动化测试脚本/extreme-test-runner.js').runFullTestSuite();
```

对于单独的测试类别，可以使用以下命令：

```javascript
// 仅运行循环依赖测试
require('./tests/自动化测试脚本/extreme-test-runner.js').runCircularDependencyTests();

// 仅运行ES6兼容性测试
require('./tests/自动化测试脚本/extreme-test-runner.js').runES6CompatibilityTests();

// 仅运行事件处理机制测试
require('./tests/自动化测试脚本/extreme-test-runner.js').runEventBusStressTests();

// 仅运行离线存储测试
require('./tests/自动化测试脚本/extreme-test-runner.js').runOfflineStorageTests();
```

### 测试环境设置

1. 确保测试环境已正确配置：

```javascript
// 测试前必须设置环境
require('./tests/自动化测试脚本/extreme-test-runner.js').setupTestEnvironment({
  mockNetwork: true,  // 启用网络模拟
  storageLimit: 10    // 设置存储限制（MB）
});
```

2. 可自定义测试参数：

```javascript
// 自定义参数
require('./tests/自动化测试脚本/extreme-test-runner.js').runFullTestSuite({
  iterations: 5000,   // 设置迭代次数
  timeout: 120000,    // 测试超时时间（毫秒）
  concurrency: 20     // 并发操作数量
});
```

### 测试结果检查

测试执行后，详细结果将保存在以下位置：

- 测试摘要: `./tests/测试报告/extreme-test-summary.json`
- 详细日志: `./tests/测试报告/extreme-test-details.log`
- 性能数据: `./tests/测试报告/performance-data.csv`

## 附录

### A. 测试代码示例

#### 循环依赖测试代码片段

```javascript
// 连续多次加载测试
function testRepeatedLoading(iterations = 1000) {
  const results = {
    success: 0,
    failure: 0,
    memoryLeaks: false
  };
  
  // 记录初始内存使用
  const initialMemory = wx.getPerformance().memory.jsHeapSizeLimit;
  
  for (let i = 0; i < iterations; i++) {
    try {
      // 强制卸载模块
      __clearModuleCache__();
      
      // 重新加载核心模块
      const CoreModule = require('../../miniprogram/core/index.js');
      
      // 验证模块功能
      if (CoreModule && typeof CoreModule.init === 'function') {
        results.success++;
      } else {
        results.failure++;
      }
    } catch (err) {
      console.error(`Iteration ${i} failed:`, err);
      results.failure++;
    }
    
    // 每100次检查一次内存
    if (i % 100 === 0) {
      wx.triggerGC(); // 触发垃圾回收
    }
  }
  
  // 最终内存检查
  wx.triggerGC();
  const finalMemory = wx.getPerformance().memory.jsHeapSizeLimit;
  results.memoryLeaks = (finalMemory - initialMemory) > 1024 * 50; // 50KB阈值
  
  return results;
}
```

### B. 测试数据记录表

以下是测试过程中的关键监控指标记录，按时间顺序排列：

| 时间点 | CPU使用率 | 内存使用 | 网络请求 | 存储使用 | 备注 |
|-------|----------|---------|---------|---------|------|
| T+0s  | 24% | 21MB | 0 | 1.2MB | 测试启动 |
| T+30s | 46% | 32MB | 14 | 2.8MB | 高频事件测试期间 |
| T+60s | 31% | 28MB | 22 | 4.5MB | 并发操作测试 |
| T+90s | 18% | 25MB | 35 | 7.2MB | 存储容量测试 |
| T+120s | 22% | 24MB | 42 | 5.4MB | 清理后恢复正常 |

---

**测试执行人**: 测试团队  
**文档创建日期**: 2024-04-07  
**最后更新日期**: 2024-04-07 