<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="title-container">
      <view class="back-btn" bindtap="goBackToCamera">
        <view class="back-icon"></view>
      </view>
      <view class="title">
        <text>照片列表</text>
        <text class="location" wx:if="{{locationName && locationName !== 'default'}}">{{locationName}}</text>
      </view>
    </view>
    
    <!-- 工具栏 -->
    <view class="toolbar">
      <block wx:if="{{!isSelectMode}}">
        <view class="tool-btn" bindtap="enterSelectMode">
          <view class="tool-icon select-icon"></view>
          <text>选择</text>
        </view>
      </block>
      <block wx:else>
        <view class="tool-btn" bindtap="exitSelectMode">
          <view class="tool-icon cancel-icon"></view>
          <text>取消</text>
        </view>
        <view class="tool-btn" bindtap="toggleSelectAll">
          <view class="tool-icon {{selectedPhotos.length === photoList.length ? 'deselect-all-icon' : 'select-all-icon'}}"></view>
          <text>{{selectedPhotos.length === photoList.length ? '取消全选' : '全选'}}</text>
        </view>
      </block>
    </view>
  </view>
  
  <!-- 照片列表 -->
  <scroll-view scroll-y="{{true}}" class="photo-list-container" bindscrolltolower="loadMorePhotos" enable-back-to-top="{{true}}">
    <!-- 加载中提示 -->
    <view class="loading-container" wx:if="{{isLoading && photoList.length === 0}}">
      <view class="loading-spinner"></view>
      <text>加载照片中...</text>
    </view>
    
    <!-- 空数据提示 -->
    <view class="empty-container" wx:if="{{isEmpty && !isLoading}}">
      <view class="empty-icon"></view>
      <text>还没有照片，返回拍摄吧</text>
      <button class="back-to-camera-btn" bindtap="goBackToCamera">返回拍照</button>
    </view>
    
    <!-- 加载错误提示 -->
    <view class="error-container" wx:if="{{loadError && !isLoading}}">
      <view class="error-icon"></view>
      <text>加载照片失败</text>
      <button class="retry-btn" bindtap="loadPhotoList">重试</button>
    </view>
    
    <!-- 照片网格列表 -->
    <view class="photo-grid" wx:if="{{photoList.length > 0}}">
      <view 
        class="photo-item {{isSelectMode && selectedPhotos.includes(item.id) ? 'selected' : ''}}" 
        wx:for="{{photoList}}" 
        wx:key="id"
        data-index="{{index}}"
        bindtap="viewPhotoDetail">
        <!-- 照片 -->
        <image class="photo-image" src="{{item.filePath}}" mode="aspectFill"></image>
        
        <!-- 选择标记 -->
        <view class="select-marker" wx:if="{{isSelectMode}}">
          <view class="select-circle {{selectedPhotos.includes(item.id) ? 'selected' : ''}}"></view>
        </view>
        
        <!-- 上传状态标记 -->
        <view class="status-marker {{item.uploadStatus}}" wx:if="{{item.uploadStatus !== 'success'}}">
          <text>{{item.uploadStatus === 'pending' ? '待上传' : '失败'}}</text>
        </view>
        
        <!-- 照片时间 -->
        <view class="photo-time">{{formatTime(item.createTime)}}</view>
      </view>
    </view>
    
    <!-- 加载更多提示 -->
    <view class="load-more" wx:if="{{hasMore && photoList.length > 0}}">
      <view class="loading-spinner" wx:if="{{isLoading}}"></view>
      <text wx:if="{{isLoading}}">加载更多...</text>
      <text wx:else>上拉加载更多</text>
    </view>
    
    <view class="load-end" wx:if="{{!hasMore && photoList.length > 0 && !isLoading}}">
      <text>已加载全部照片</text>
    </view>
  </scroll-view>
  
  <!-- 底部操作栏 -->
  <view class="action-bar" wx:if="{{isSelectMode && photoList.length > 0}}">
    <view class="action-info">
      <text>已选择 {{actionBarInfo.selected}}/{{actionBarInfo.total}} 张照片</text>
    </view>
    
    <view class="action-buttons">
      <view class="action-btn delete" bindtap="deleteSelectedPhotos">
        <view class="action-icon delete-icon"></view>
        <text>删除</text>
      </view>
      
      <view class="action-btn upload" bindtap="uploadSelectedPhotos">
        <view class="action-icon upload-icon"></view>
        <text>上传</text>
        <view class="badge" wx:if="{{actionBarInfo.pendingCount > 0}}">{{actionBarInfo.pendingCount}}</view>
      </view>
    </view>
  </view>
</view>

<!-- 工具函数 -->
<wxs module="formatTime">
  module.exports = function(timestamp) {
    if (!timestamp) return '';
    var date = getDate(timestamp);
    var month = date.getMonth() + 1;
    var day = date.getDate();
    var hour = date.getHours();
    var minute = date.getMinutes();
    
    month = month < 10 ? '0' + month : month;
    day = day < 10 ? '0' + day : day;
    hour = hour < 10 ? '0' + hour : hour;
    minute = minute < 10 ? '0' + minute : minute;
    
    return month + '-' + day + ' ' + hour + ':' + minute;
  }
</wxs> 