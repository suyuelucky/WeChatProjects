<view class="container">
  <view class="header">
    <view class="title">照片采集工具</view>
    <view class="subtitle">请选择项目和拍摄位置</view>
  </view>
  
  <!-- 加载中显示 -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text>加载项目信息中...</text>
  </view>
  
  <!-- 项目选择区域 -->
  <view class="selection-area" wx:if="{{!isLoading}}">
    <!-- 项目选择部分 -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">项目</text>
        <view class="add-btn" bindtap="openAddProjectDialog">
          <text class="add-icon">+</text>
          <text>新建项目</text>
        </view>
      </view>
      
      <view class="section-content">
        <scroll-view scroll-x="{{true}}" class="project-list" enable-flex="{{true}}">
          <view 
            wx:for="{{projects}}" 
            wx:key="id"
            class="project-item {{selectedProject === item.id ? 'selected' : ''}}"
            data-project-id="{{item.id}}"
            bindtap="selectProject">
            <view class="project-name">{{item.name}}</view>
            <view class="project-info">{{item.locations.length}}个位置</view>
          </view>
          
          <!-- 空项目提示 -->
          <view class="empty-project" wx:if="{{projects.length === 0}}">
            <text>暂无项目，点击"新建项目"按钮创建</text>
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- 位置选择部分 -->
    <view class="section" wx:if="{{selectedProject}}">
      <view class="section-header">
        <text class="section-title">位置</text>
        <view class="add-btn" bindtap="openAddLocationDialog">
          <text class="add-icon">+</text>
          <text>新建位置</text>
        </view>
      </view>
      
      <view class="section-content">
        <scroll-view scroll-y="{{true}}" class="location-list">
          <view 
            wx:for="{{projects.find(p => p.id === selectedProject).locations}}" 
            wx:key="*this"
            class="location-item {{selectedLocation === item ? 'selected' : ''}}"
            data-location="{{item}}"
            bindtap="selectLocation">
            <view class="location-name">{{item}}</view>
            <view class="check-icon" wx:if="{{selectedLocation === item}}"></view>
          </view>
          
          <!-- 空位置提示 -->
          <view class="empty-location" wx:if="{{!projects.find(p => p.id === selectedProject).locations.length}}">
            <text>暂无位置，点击"新建位置"按钮创建</text>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
  
  <!-- 操作按钮区域 -->
  <view class="action-area" wx:if="{{!isLoading}}">
    <button 
      class="action-button capture-button" 
      bindtap="startPhotoCapture"
      disabled="{{!selectedProject || !selectedLocation}}">
      开始拍照
    </button>
    
    <button 
      class="action-button view-button" 
      bindtap="viewPhotoList"
      disabled="{{!selectedProject || !selectedLocation}}">
      查看照片列表
    </button>
  </view>
  
  <!-- 新建项目对话框 -->
  <view class="dialog-mask" wx:if="{{showAddProjectDialog}}" bindtap="closeAddProjectDialog"></view>
  <view class="dialog" wx:if="{{showAddProjectDialog}}" catchtap="preventBubble">
    <view class="dialog-header">
      <text class="dialog-title">新建项目</text>
    </view>
    
    <view class="dialog-content">
      <input 
        class="dialog-input" 
        placeholder="请输入项目名称" 
        value="{{newProjectName}}"
        bindinput="inputProjectName" />
      
      <view class="error-message" wx:if="{{formError}}">{{formError}}</view>
    </view>
    
    <view class="dialog-footer">
      <button class="dialog-btn cancel-btn" bindtap="closeAddProjectDialog">取消</button>
      <button class="dialog-btn confirm-btn" bindtap="addNewProject">确定</button>
    </view>
  </view>
  
  <!-- 新建位置对话框 -->
  <view class="dialog-mask" wx:if="{{showAddLocationDialog}}" bindtap="closeAddLocationDialog"></view>
  <view class="dialog" wx:if="{{showAddLocationDialog}}" catchtap="preventBubble">
    <view class="dialog-header">
      <text class="dialog-title">新建位置</text>
    </view>
    
    <view class="dialog-content">
      <input 
        class="dialog-input" 
        placeholder="请输入位置名称" 
        value="{{newLocationName}}"
        bindinput="inputLocationName" />
      
      <view class="error-message" wx:if="{{formError}}">{{formError}}</view>
    </view>
    
    <view class="dialog-footer">
      <button class="dialog-btn cancel-btn" bindtap="closeAddLocationDialog">取消</button>
      <button class="dialog-btn confirm-btn" bindtap="addNewLocation">确定</button>
    </view>
  </view>
  
  <!-- 页脚信息 -->
  <view class="footer">
    <text>照片采集工具 v1.0</text>
  </view>
</view>

<!-- 防止事件冒泡的函数 -->
<wxs module="preventBubble">
  module.exports = function(e) {
    e.stopPropagation();
  }
</wxs> 