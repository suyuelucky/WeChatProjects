# B1: 基础照片采集 技术债务记录

## 技术债务清单

| 债务ID | 描述 | 影响范围 | 严重程度 | 建议解决时间 | 状态 |
|-------|------|---------|---------|------------|------|
| TD001 | Camera组件在部分旧设备上的兼容性问题 | 相机功能 | 中 | 下一迭代 | 未解决 |
| TD002 | 本地存储空间管理机制不完善 | 照片存储 | 高 | 本迭代结束前 | 未解决 |
| TD003 | 缺少降级方案处理弱网环境 | 照片上传 | 中 | 下一迭代 | 未解决 |
| TD004 | 原图存储需求尚未支持 | 照片质量 | 低 | 未来规划 | 未解决 |
| TD005 | 缺少全面的性能优化机制 | 全局性能 | 中 | 下一迭代 | 未解决 |

## 详细描述

### TD001: Camera组件在部分旧设备上的兼容性问题

**问题描述**：
微信小程序原生camera组件在部分旧设备（特别是Android 7.0以下和iOS 10以下）上存在兼容性问题，可能出现预览黑屏、拍照失败或权限异常等情况。当前实现未充分处理这些特殊情况。

**当前解决方案**：
目前仅有基础的错误捕获和提示，但缺乏系统性的兼容性测试和针对性解决方案。

**理想解决方案**：
1. 建立设备兼容性测试矩阵，覆盖各种系统版本和机型
2. 为不支持camera组件的设备提供wx.chooseImage作为备选方案
3. 实现设备特性检测机制，自动选择最佳相机接入方式
4. 维护已知问题设备清单并提供针对性兼容方案

**解决影响**：
解决此问题将显著提高应用在旧设备上的可用性，降低用户投诉和负面评价。

**所需资源**：
工程师2人日，测试设备矩阵搭建，多设备测试资源。

**相关代码位置**：
`/components/camera/camera.js` 和 `/pages/capture/index.js`

### TD002: 本地存储空间管理机制不完善

**问题描述**：
当前实现中，照片存储到本地后缺乏完善的空间管理机制。长期使用可能导致存储空间耗尽，影响应用稳定性和用户体验。特别是在存储空间有限的旧设备上风险更高。

**当前解决方案**：
仅在存储照片前检查剩余空间，但没有主动管理和清理机制。

**理想解决方案**：
1. 实现存储空间监控和预警机制
2. 建立照片自动过期和清理策略（如已上传且超过30天的本地照片）
3. 提供用户可控的存储管理界面
4. 实现紧急情况下的自动空间释放机制

**解决影响**：
防止因存储空间不足导致的数据丢失和应用崩溃，提高系统长期稳定性。

**所需资源**：
工程师3人日，包括开发和测试。

**相关代码位置**：
`/services/storage/photo-storage.js` 和 `/utils/file-manager.js`

### TD003: 缺少降级方案处理弱网环境

**问题描述**：
当前上传实现在弱网或网络不稳定环境下缺乏有效的降级策略，可能导致上传失败率高、用户体验差，甚至照片丢失风险。

**当前解决方案**：
基本的重试机制和错误提示，但缺乏智能调整和用户可控的上传策略。

**理想解决方案**：
1. 实现网络质量感知机制，动态调整上传策略
2. 增强断点续传能力，支持任意时间点恢复
3. 提供上传队列优先级控制，确保重要照片优先上传
4. 实现弱网环境下的照片分片上传和压缩策略调整

**解决影响**：
显著提高在各种网络环境下的上传成功率和用户体验。

**所需资源**：
工程师4人日，测试2人日，包括网络模拟环境测试。

**相关代码位置**：
`/services/network/upload-service.js` 和 `/utils/network-monitor.js`

### TD004: 原图存储需求尚未支持

**问题描述**：
现有方案采用两级压缩策略（预览小图+标准图），未保留原始照片。某些专业场景可能需要更高质量的图片，当前实现无法满足。

**当前解决方案**：
所有照片统一压缩存储，无原图备份选项。

**理想解决方案**：
1. 提供用户可选的原图存储选项
2. 实现云端原图存储与本地压缩图分离策略
3. 根据用户需求和设备存储空间动态调整存储策略
4. 支持后期原图下载和查看

**解决影响**：
满足特定用户对高质量图片的需求，扩大产品适用场景。

**所需资源**：
产品需求评估1人日，工程师3人日。

**相关代码位置**：
`/services/image/image-processor.js` 和 `/config/storage-config.js`

### TD005: 缺少全面的性能优化机制

**问题描述**：
当前实现中性能优化主要集中在照片列表加载和图片压缩方面，缺乏全面系统的性能监控和优化机制，在大量照片场景下可能出现性能问题。

**当前解决方案**：
局部优化和基本的内存管理策略。

**理想解决方案**：
1. 实现全面的性能监控系统，收集关键指标
2. 建立性能预警和自动优化机制
3. 增强内存管理和资源回收策略
4. 引入更高效的照片处理和渲染算法
5. 实现后台预处理和智能预加载

**解决影响**：
提高应用整体性能，特别是在照片量大或低端设备上的表现。

**所需资源**：
性能分析2人日，优化实现4人日。

**相关代码位置**：
分散在多个模块，主要在 `/pages/list/index.js` 和 `/components/photo-list/index.js`

---

创建日期: 2023-04-05
最后更新: 2023-04-06
