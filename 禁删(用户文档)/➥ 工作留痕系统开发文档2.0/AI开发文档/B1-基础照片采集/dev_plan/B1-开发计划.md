# B1: 基础照片采集 开发计划

## 1. 任务概述

基础照片采集是工作留痕系统的重要组成部分，负责提供便捷的拍照入口和多种拍照模式，是留痕系统的核心内容来源。该功能允许用户高效拍摄、存储和管理工作照片，为后续内容处理与发布提供基础素材。

## 2. 功能点分解

- [x] 功能点1: 相机调用与权限管理
  - 预计耗时: 4小时
  - 技术路径: 使用微信小程序camera组件，结合wx.authorize实现权限管理
  - 验收标准: 能够正确申请和判断相机权限，处理用户拒绝情况
  - 完成情况: 基本实现相机调用和初始化，但权限被拒绝后的引导可优化
- [x] 功能点2: 标准拍照功能
  - 预计耗时: 4小时
  - 技术路径: 实现标准模式拍照，包括前后置切换、闪光灯控制
  - 验收标准: 标准模式下能稳定拍照，并正确保存图片
  - 完成情况: 已实现基本拍照功能，前后置切换和闪光灯控制
- [ ] 功能点3: 连拍与定时拍照功能
  - 预计耗时: 4小时
  - 技术路径: 基于标准拍照扩展连拍模式和定时模式
  - 验收标准: 两种扩展模式下均能稳定拍照，且有合理的交互提示
  - 完成情况: 未实现，需要开发
- [x] 功能点4: 照片临时存储与管理
  - 预计耗时: 6小时
  - 技术路径: 使用微信小程序提供的本地存储和文件系统API
  - 验收标准: 拍摄的照片能够临时保存，支持预览、删除操作
  - 完成情况: 基本实现照片的本地存储和管理，但列表功能有优化空间
- [ ] 功能点5: 照片上传与云存储
  - 预计耗时: 6小时
  - 技术路径: 结合微信小程序云开发能力实现照片上传和云端存储
  - 验收标准: 照片能够稳定上传至云端，支持断点续传和上传进度显示
  - 完成情况: 基础存储逻辑已实现，上传功能待开发
- [ ] 功能点6: 拍照交互优化
  - 预计耗时: 4小时
  - 技术路径: 添加拍照反馈动效、声音提示及适配不同设备屏幕
  - 验收标准: 拍照过程流畅，有明确的操作反馈，适配常见设备尺寸
  - 完成情况: 基础界面已实现，需要优化交互体验和增加反馈效果

## 3. 技术方案

### 3.1 方案概述

照片采集功能将采用微信小程序原生能力构建，遵循"轻量级前端处理+云端存储"的设计思路。前端主要负责拍照交互和基础处理，重型处理和永久存储则依赖云服务完成，确保小程序性能和存储安全。

### 3.2 技术选型

- **前端框架**: 微信小程序原生框架
- **UI组件**: 微信小程序内置组件(camera, image, view等)
- **存储方案**: 本地存储(wx.setStorage) + 云存储(wx.cloud.uploadFile)
- **处理能力**: Canvas处理(压缩、裁剪) + 云函数(高级处理)

### 3.3 架构设计

采用MVP(Model-View-Presenter)架构:
- **Model层**: 照片数据模型，包含照片元数据、存储状态等
- **View层**: 拍照界面、预览界面、照片列表界面
- **Presenter层**: 照片服务，负责处理拍照逻辑、存储逻辑和云端交互

核心组件:
1. **CameraManager**: 相机控制与拍照实现
2. **PhotoStorage**: 照片存储与检索服务
3. **CloudUploader**: 云端上传与同步服务
4. **UIComponents**: 照片预览、列表等界面组件

## 4. 已完成工作分析

### 4.1 已实现功能

- 基础相机调用与初始化
- 标准拍照模式与照片预览
- 前后置摄像头切换
- 闪光灯模式切换
- 照片本地存储
- 照片列表基础展示
- 照片预览与删除

### 4.2 当前实现的不足

- 相机错误处理机制不完善，缺乏友好的失败提示和恢复机制
- 照片列表缺乏分页加载，大量照片可能导致性能问题
- 未实现照片的压缩优化，大图可能占用过多存储空间
- 缺少连拍和定时拍照等高级功能
- 拍照过程缺乏视觉和声音反馈，交互体验有待提升
- 未实现照片云端上传和同步机制

## 5. 待完成工作清单

### 5.1 当前迭代重点任务

1. **连拍和定时拍照功能**
   - 连拍模式实现，支持设置间隔时间和总数量
   - 定时拍照实现，支持倒计时提示和自动拍摄
   - 模式切换UI和交互优化

2. **照片压缩与优化**
   - 优化照片压缩算法，减少存储占用
   - 实现照片缩略图生成，提升列表加载性能
   - 增加图片质量选项，支持用户自定义

3. **照片云端上传**
   - 实现照片后台上传功能
   - 添加上传进度显示和状态管理
   - 支持失败重试和断点续传
   - 网络状态监测和离线处理

4. **交互体验优化**
   - 添加拍照音效和动画反馈
   - 优化相机控制区布局，增强操作便捷性
   - 增加拍照辅助线和构图辅助

### 5.2 优先级顺序

1. 连拍和定时拍照功能 (核心功能缺失)
2. 照片压缩与优化 (性能与空间优化)
3. 照片云端上传 (数据持久化需求)
4. 交互体验优化 (用户体验提升)

## 6. 潜在风险

| 风险描述 | 影响 | 可能性 | 缓解策略 |
|---------|-----|-------|---------|
| 用户拒绝相机权限 | 高 | 中 | 提供明确的权限说明，实现无相机模式(从相册选择) |
| 照片上传失败 | 高 | 中 | 实现本地缓存、断点续传和错误重试机制 |
| 大量照片导致内存占用过高 | 中 | 高 | 实现虚拟列表渲染和照片懒加载机制 |
| 低端设备相机性能不佳 | 中 | 中 | 提供低性能模式，降低分辨率和处理效果要求 |
| 存储空间不足 | 中 | 低 | 实现存储空间检测和自动清理临时文件机制 |

## 7. 测试计划

| 测试类型 | 测试范围 | 测试方法 | 通过标准 |
|---------|---------|---------|---------|
| 单元测试 | 拍照功能、存储功能、上传功能 | 模拟相机输入、模拟存储调用、模拟网络请求 | 各功能模块独立工作正常 |
| 集成测试 | 完整拍照流程、云存储交互 | 端到端测试拍照到上传完整流程 | 流程完整无中断 |
| 性能测试 | 连续拍照、大量照片显示、并发上传 | 压力测试和资源监控 | 内存占用<50MB，CPU使用<30% |
| 兼容性测试 | 不同机型和系统版本 | 在主流机型上进行测试 | 在95%以上机型正常工作 |

## 8. 更新后时间规划

| 阶段 | 开始时间 | 结束时间 | 主要任务 |
|------|---------|---------|---------|
| 分析已有代码 | 2024-04-06 | 2024-04-06 | 代码审查、功能测试、确定待完成工作 |
| 连拍与定时功能开发 | 2024-04-07 | 2024-04-08 | 实现连拍和定时拍照模式，完善UI交互 |
| 照片优化与云存储 | 2024-04-09 | 2024-04-10 | 照片压缩、缩略图生成、云端上传功能 |
| 交互优化与测试 | 2024-04-11 | 2024-04-12 | 交互体验改进、全面功能测试、性能优化 |
| 文档与收尾 | 2024-04-13 | 2024-04-13 | 完善开发文档、修复遗留问题、准备发布 |

## 9. 依赖关系

| 依赖项 | 类型 | 状态 | 负责人 |
|-------|-----|------|-------|
| 微信Camera组件 | 外部 | 已就绪 | 微信官方 |
| 云存储服务 | 内部 | 需配置 | AI开发者 |
| 小程序基础架构 | 内部 | 已就绪 | 系统架构组 |
| 用户授权管理模块 | 内部 | 需接入 | AI开发者 |
| 图片压缩工具 | 内部 | 需优化 | AI开发者 |
| 网络监控服务 | 内部 | 需开发 | AI开发者 |

---

创建日期: 2024-04-05
更新日期: 2024-04-06
