# TC-A2-01: 存储极限容量测试

> **测试用例编号**: TC-A2-01  
> **测试级别**: 系统测试  
> **测试类型**: 极限测试  
> **前提条件**: 应用正常安装，存储管理模块功能完整  
> **测试状态**: ⏳ 等待测试

## 1. 测试目标

验证系统在本地存储接近或达到微信小程序限制(10MB)时的行为，确认存储管理模块能够正确识别存储压力并采取适当措施，保障核心功能可用性。

## 2. 测试环境

- **硬件环境**: 
  - PC端微信开发者工具(版本: 1.06.2403061)
  - iPhone 11(iOS 15.5)
  - 小米10(Android 12)
  
- **软件环境**:
  - 微信版本: 最新正式版
  - 测试工具: 存储监控工具
  - 数据生成工具: 自动填充数据脚本

## 3. 测试数据

- 测试用的大体积数据集(图片、文本、配置项)
- 存储状态监控日志
- 自动清理事件记录

## 4. 测试步骤

### 4.1 基础存储状态确认

1. 清空测试设备上的应用存储数据(卸载重装或使用清理功能)
2. 启动应用并记录初始存储使用情况：
   - 当前已使用空间大小
   - 存储限制大小
   - 已存储的键数量
3. 使用storageManager的API获取详细存储信息并记录

### 4.2 存储容量递增测试

1. **70%存储容量测试**:
   - 使用测试脚本向存储中添加数据，直到达到约70%容量(~7MB)
   - 记录此时的存储状态和管理器行为
   - 验证是否触发警告通知机制
   - 继续使用应用核心功能，观察性能表现

2. **85%存储容量测试**:
   - 继续添加数据至约85%容量(~8.5MB)
   - 记录此时存储状态和自动清理行为
   - 验证是否触发自动清理机制
   - 分析清理的数据类型是否符合优先级设置

3. **95%存储容量测试**:
   - 继续添加数据至约95%容量(~9.5MB)
   - 记录此时存储状态和系统响应
   - 验证紧急清理机制是否触发
   - 测试核心功能是否仍能正常工作

4. **100%+存储容量测试**:
   - 尝试继续添加数据直至超过存储限制
   - 记录系统行为和错误处理方式
   - 验证用户提示信息的清晰度和操作指引

### 4.3 自动清理机制测试

1. **清理策略验证**:
   - 在高存储占用状态(>85%)下，通过日志和存储监控分析自动清理行为
   - 验证清理是否遵循以下优先级:
     - 临时文件(temp)
     - 缓存文件(cache)
     - 过期数据
     - 低优先级用户数据
   - 确认核心用户数据和系统配置未被清理

2. **手动清理功能测试**:
   - 测试应用提供的手动清理功能
   - 验证清理后的存储状态
   - 确认用户收到清晰的清理反馈

3. **恢复功能测试**:
   - 在清理后验证应用核心功能恢复情况
   - 测试用户数据一致性和完整性
   - 验证应用性能是否恢复正常

### 4.4 极端场景测试

1. **多模块并发存储测试**:
   - 在存储接近限制(>90%)时，同时触发多个模块的存储操作
   - 记录各模块存储行为和优先级处理
   - 验证关键业务模块是否获得存储优先权

2. **存储崩溃恢复测试**:
   - 在存储操作过程中模拟应用崩溃(强制关闭)
   - 重启应用，验证存储一致性和恢复机制
   - 测试数据保护机制的有效性

3. **反复清理-填充循环测试**:
   - 执行至少5轮"填充-清理-填充"循环
   - 验证长期使用下存储管理的稳定性
   - 检查是否有存储空间泄露或碎片化问题

## 5. 预期结果

1. **容量监控准确性**:
   - 系统准确监控和报告存储使用状况
   - 存储警告阈值设置合理
   - 用户收到清晰的存储状态通知

2. **自动清理有效性**:
   - 自动清理在适当阈值触发
   - 清理优先级正确，重要数据得到保护
   - 清理过程不阻塞用户操作

3. **极限容量下的稳定性**:
   - 接近存储限制时，核心功能仍可用
   - 达到存储限制时，提供清晰的用户引导
   - 没有意外的应用崩溃或数据损坏

4. **用户体验**:
   - 存储问题相关通知友好且信息充分
   - 提供有效的用户自助解决方案
   - 性能不因存储压力显著下降

## 6. 测试记录表

| 测试项 | 测试条件 | 预期结果 | 实际结果 | 状态 | 备注 |
|-------|---------|---------|---------|------|------|
| 初始存储状态 | 清空后首次启动 | 存储使用<1MB | | | |
| 70%容量测试 | 填充至约7MB | 发出警告通知 | | | |
| 85%容量测试 | 填充至约8.5MB | 触发自动清理 | | | |
| 95%容量测试 | 填充至约9.5MB | 触发紧急清理 | | | |
| 超限测试 | 尝试超过10MB | 拒绝存储，友好提示 | | | |
| 清理优先级 | 自动清理触发 | 按优先级顺序清理 | | | |
| 手动清理 | 用户触发清理 | 清理成功，反馈清晰 | | | |
| 功能恢复 | 清理后操作 | 功能正常，性能恢复 | | | |
| 并发存储 | 多模块同时存储 | 按优先级处理，无冲突 | | | |
| 崩溃恢复 | 强制关闭后重启 | 数据一致性维持 | | | |
| 循环测试 | 5轮填充-清理循环 | 存储管理稳定，无泄漏 | | | |

## 7. 测试结论

> 待测试完成后填写

## 8. 问题记录

> 待测试执行过程中填写

## 9. 附件

- 测试数据生成脚本
- 存储监控日志
- 关键测试点截图
- 自动清理触发记录

---

**测试执行人**:   
**测试日期**:   
**审核人**:   