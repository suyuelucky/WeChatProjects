# AI工业级开发流程规范

> **重要更新**: 本规范已升级为自动化流程版，要求AI开发者必须按照索引.md中的全自动开发流程执行，接收到任务后立即执行初始化脚本并完成全部开发工作。

## 文档目的与适用范围

本文档定义了工作留痕系统开发过程中，AI助手进行开发工作必须遵循的工业级流程规范。旨在确保每个AI开发会话都能维持高标准的代码质量、文档完整性和流程可追溯性，有效解决AI开发中的连续性和知识传递问题。

### 适用范围

- 所有使用AI助手(如Claude)进行的代码开发、调试和测试活动
- 所有与工作留痕系统相关的功能模块开发
- 适用于每个独立的AI开发会话

### 规范核心原则

1. **工业化流程**: 严格按照软件工程领域成熟的开发流程执行
2. **小步快跑**: 将复杂功能分解为可独立验证的最小单元，逐一完成
3. **验证驱动**: 每个功能点必须有明确的验证标准和测试方法
4. **文档同步**: 代码与文档必须同步更新，保持一致
5. **知识传递**: 确保关键决策和经验能够在不同会话间有效传递

## 1. 开发前准备阶段

在开始实际编码前，每个AI开发会话必须完成以下准备工作，确保开发方向正确且有必要的上下文信息。

### 1.1 需求理解与澄清

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 阅读任务描述 | 能够用自己的话重述任务目标 | 任务理解描述 |
| 查阅相关文档 | 根据索引文档找到与任务相关的技术文档 | 关键文档摘要 |
| 需求澄清 | 识别并解决任何不明确的需求点 | 需求澄清问题清单 |
| 功能边界确认 | 明确定义功能的范围和边界 | 功能范围定义 |

### 1.2 现有代码分析

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 代码库结构理解 | 掌握项目的目录结构与组织方式 | 代码结构概述 |
| 相关组件分析 | 分析与当前任务相关的现有组件 | 组件依赖图 |
| 接口规范确认 | 理解现有组件的接口设计模式 | 接口使用说明 |
| 代码风格分析 | 理解项目的代码风格和命名规范 | 代码规范摘要 |

### 1.3 技术可行性评估

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 技术方案研究 | 至少提出2种可能的实现方案 | 技术方案对比 |
| 微信API兼容性检查 | 确认所需API的可用性和兼容性 | API兼容性报告 |
| 性能影响评估 | 评估方案对应用性能的潜在影响 | 性能风险评估 |
| 技术风险识别 | 识别实现过程中可能的技术风险 | 风险预警清单 |

### 1.4 开发环境准备

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 工具链确认 | 确认所需的开发工具和库是否可用 | 工具依赖清单 |
| 本地存储准备 | 确认所需的本地存储机制 | 存储需求描述 |
| 模拟数据准备 | 创建开发和测试所需的模拟数据 | 测试数据集 |
| 调试方法确认 | 确定适合当前任务的调试方法 | 调试策略说明 |

## 2. 开发计划阶段

在正式开始编码前，必须制定详细的开发计划，确保开发过程有序可控，并且能够及时追踪进度。

### 2.1 功能分解

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 功能点识别 | 将任务分解为5-8个独立功能点 | 功能点清单 |
| 优先级排序 | 根据依赖关系和重要性排序 | 优先级排序表 |
| 工作量评估 | 评估每个功能点的复杂度和耗时 | 工作量评估表 |
| 依赖关系分析 | 明确功能点之间的依赖关系 | 依赖关系图 |

### 2.2 计划文档编写

计划文档必须使用标准模板创建，存放在项目的`开发计划`目录下，命名格式为`[任务代号]-开发计划.md`。计划文档必须包含以下内容：

```markdown
# [任务代号]: [任务名称] 开发计划

## 1. 任务概述
[简要描述任务目标和价值]

## 2. 功能点分解
- [ ] 功能点1: [描述]
  - 预计耗时: [估计]
  - 技术路径: [简述]
  - 验收标准: [明确标准]
- [ ] 功能点2: [描述]
  ...

## 3. 技术方案
[详细描述选定的技术方案和理由]

## 4. 潜在风险
[列出潜在风险和应对策略]

## 5. 测试计划
[描述如何测试验证每个功能点]

## 6. 时间规划
[总体时间安排]
```

### 2.3 基础设施准备

| 必要步骤 | 完成标准 | 输出物 |
|---------|---------|-------|
| 目录结构创建 | 创建开发所需的文件目录结构 | 目录结构图 |
| 基础代码框架 | 搭建最小化的代码框架 | 框架代码 |
| 接口定义 | 定义组件的公共接口 | 接口定义文档 |
| 配置文件准备 | 准备必要的配置文件 | 配置文件 |

### 2.4 开发会话配置

每个AI开发会话必须在开始时创建会话配置信息，记录在开发计划文档的顶部：

```
会话ID: DEV-[模块代号]-[序号]-[日期]
会话目标: [本次会话的具体目标]
预期输出: [会话结束时应该完成的工作]
时间限制: [会话的估计时间]
```

计划阶段产出的所有文档必须经过用户确认后才能进入实际开发阶段。

## 3. 开发实施阶段

开发实施是整个流程的核心阶段，必须遵循"小步快跑"的原则，逐个功能点实现和验证，确保每步都达到预期的质量标准。

### 3.1 开发节奏与提交规范

| 规范项 | 标准要求 | 说明 |
|--------|----------|------|
| 提交粒度 | 每完成一个功能点提交一次 | 避免大块代码一次提交 |
| 提交消息 | `[任务代号-功能点]: 简要描述` | 保持消息一致性和可追踪性 |
| 开发节奏 | 50-100行代码/提交 | 控制单次修改的范围 |
| 工作计时 | 每个功能点记录实际耗时 | 与计划进行对比分析 |

### 3.2 代码实现规范

#### 3.2.1 微信小程序特定规范

1. **兼容性要求**:
   - 所有代码必须符合ES5标准，禁止使用ES6+特性
   - 禁止使用箭头函数、解构赋值、Proxy等特性
   - 使用`wx.canIUse`检查API可用性，提供降级方案

2. **性能要求**:
   - 控制setData频率和数据量，避免频繁更新
   - 长列表使用虚拟列表优化
   - 图片资源必须优化压缩，控制在100KB以内

3. **组件化要求**:
   - 每个组件必须包含完整的四个文件(js/wxss/wxml/json)
   - 组件间通信必须使用properties和事件，避免直接操作
   - 组件嵌套不超过5层

#### 3.2.2 通用代码规范

1. **命名规范**:
   - 变量/函数: 驼峰命名法(camelCase)
   - 组件/类: 大驼峰命名法(PascalCase)
   - 常量: 全大写下划线分隔(UPPER_SNAKE_CASE)

2. **注释规范**:
   - 函数必须有JSDoc风格注释说明用途、参数、返回值
   - 复杂逻辑必须有行内注释
   - 必须注明代码的来源和参考资料

3. **错误处理**:
   - 所有异步操作必须有完整的错误处理
   - 所有网络请求必须处理超时和失败情况
   - 用户交互必须考虑异常路径

### 3.3 进度追踪与更新

在开发过程中，必须实时更新开发计划文档中的进度：

1. 每完成一个功能点，在计划文档中将对应项标记为完成状态:
   ```markdown
   - [x] 功能点1: 已完成的功能描述
     - 实际耗时: XX分钟
     - 遇到的问题: 简要描述问题及解决方案
   ```

2. 每个功能点完成后，必须立即记录:
   - 实际实现方案
   - 遇到的技术问题
   - 解决方案
   - 潜在的优化点

### 3.4 关键点记录与决策文档

对于重要的技术决策和关键点，必须创建决策记录，格式如下：

```markdown
# 决策记录: [决策标题]

## 背景
[描述做出决策的背景和原因]

## 考虑的方案
1. [方案1]
   - 优点: ...
   - 缺点: ...
2. [方案2]
   ...

## 最终决策
[说明最终选择的方案和理由]

## 影响范围
[描述此决策可能影响的其他组件或功能]

## 实施计划
[如何实施这个决策]
```

所有决策记录必须保存在项目的`决策记录`目录下，命名格式为`[任务代号]-[决策简述].md`。

## 4. 测试验证阶段

测试验证是确保功能质量的关键阶段，必须对每个功能点进行全面、系统的测试，确保其在各种情况下都能正常工作。遵循"尽早发现问题"的原则，测试必须与开发同步进行，而非集中在开发完成后。

### 4.1 测试类型与范围

每个功能点必须经过以下类型的测试：

| 测试类型 | 测试内容 | 必要性 | 输出物 |
|---------|---------|--------|-------|
| 单元测试 | 测试独立函数和方法的正确性 | 必须 | 单元测试用例及结果 |
| 集成测试 | 测试组件间交互和数据流 | 必须 | 集成测试用例及结果 |
| 边界测试 | 测试边界值和极端情况 | 必须 | 边界测试用例及结果 |
| UI测试 | 测试界面布局和响应式适配 | 必须 | UI测试截图及结果 |
| 性能测试 | 测试操作响应时间和资源消耗 | 推荐 | 性能测试数据及分析 |

### 4.2 极端测试用例设计

对于每个功能点，必须设计并执行以下极端测试用例：

1. **输入极值测试**:
   - 空值/null/undefined处理
   - 极大/极小值测试
   - 特殊字符和非预期格式

2. **状态极端测试**:
   - 网络中断/恢复测试
   - 存储空间不足测试
   - 权限拒绝测试

3. **性能极限测试**:
   - 大量数据处理测试
   - 快速操作/点击测试
   - 内存占用监控

4. **兼容性极端测试**:
   - 最低支持版本测试
   - 不同尺寸设备测试
   - 低配置设备测试

### 4.3 测试用例文档规范

每个功能点必须创建测试用例文档，保存在`测试用例`目录下，命名格式为`[任务代号]-[功能点]-测试用例.md`，内容格式如下：

```markdown
# [功能点名称] 测试用例

## 基本功能测试
| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 通过状态 |
|-------|---------|---------|---------|---------|---------|
| BF01  | 正常操作 | 1. 步骤1<br>2. 步骤2 | 预期结果描述 | 实际结果描述 | [通过/失败] |
| BF02  | ... | ... | ... | ... | ... |

## 边界条件测试
| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 通过状态 |
|-------|---------|---------|---------|---------|---------|
| BC01  | 边界条件1 | ... | ... | ... | ... |
| BC02  | ... | ... | ... | ... | ... |

## 错误处理测试
| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 实际结果 | 通过状态 |
|-------|---------|---------|---------|---------|---------|
| EH01  | 错误情况1 | ... | ... | ... | ... |
| EH02  | ... | ... | ... | ... | ... |

## 性能测试
| 用例ID | 测试场景 | 测试指标 | 预期结果 | 实际结果 | 通过状态 |
|-------|---------|---------|---------|---------|---------|
| PF01  | 性能场景1 | 响应时间 | < 300ms | 测量结果 | [通过/失败] |
| PF02  | ... | ... | ... | ... | ... |

## 测试结论
[总体测试结论，是否通过验收]

## 发现的问题
[列出测试过程中发现的所有问题]

## 改进建议
[针对问题提出的改进建议]
```

### 4.4 自动化测试要求

对于可自动化测试的功能点，必须开发自动化测试脚本，保存在`自动测试`目录下。

自动化测试应包含：

1. **单元测试脚本**：测试核心业务逻辑
2. **模拟数据生成器**：生成各种测试场景的数据
3. **API模拟响应**：模拟后端API的各种响应
4. **自动化回归测试**：确保修改不破坏现有功能

### 4.5 测试报告规范

每个功能点测试完成后，必须生成测试报告，保存在`测试报告`目录下，命名格式为`[任务代号]-[功能点]-测试报告.md`，报告内容必须包括：

1. **测试摘要**：简要描述测试范围和结果
2. **测试统计**：测试用例总数、通过数、失败数
3. **问题列表**：发现的所有问题及严重程度
4. **修复状态**：问题修复的状态和验证结果
5. **测试结论**：功能是否达到发布标准
6. **附录**：测试截图、日志和其他相关资料

## 5. 文档与知识传递阶段

文档和知识传递是确保开发成果可维护、可扩展的关键环节，也是解决AI开发中"记忆"问题的重要机制。每个会话必须生成完整的文档并实现知识的有效传递。

### 5.1 代码注释与API文档

#### 5.1.1 代码内注释规范

所有代码必须按照以下规范添加注释：

1. **文件头注释**:
   ```javascript
   /**
    * @fileoverview [文件功能描述]
    * @author AI-Assistant
    * @created [创建日期]
    * @lastModified [最后修改日期]
    * @module [模块名]
    */
   ```

2. **函数/方法注释**:
   ```javascript
   /**
    * [函数功能描述]
    * @param {Type} paramName - [参数描述]
    * @returns {Type} [返回值描述]
    * @throws {ErrorType} [可能抛出的错误]
    * @example [使用示例]
    */
   ```

3. **类/组件注释**:
   ```javascript
   /**
    * [类/组件功能描述]
    * @class
    * @property {Type} propName - [属性描述]
    * @event {Type} eventName - [事件描述]
    */
   ```

#### 5.1.2 API文档生成

对于所有公共API和组件，必须生成API文档，存放在`API文档`目录下，命名格式为`[模块名]-API文档.md`，内容包括：

1. **模块概述**: 功能、用途和适用场景
2. **API清单**: 所有公开的API及简要说明
3. **详细API说明**: 每个API的参数、返回值、示例
4. **类型定义**: 相关的数据类型定义
5. **使用示例**: 完整的代码示例
6. **注意事项**: 使用时的注意事项和限制

### 5.2 技术债务记录

所有识别出但尚未解决的技术问题必须记录在技术债务文档中，存放在`技术债务`目录下，命名格式为`[任务代号]-技术债务.md`，内容格式如下：

```markdown
# [任务名称] 技术债务记录

## 技术债务清单

| 债务ID | 描述 | 影响范围 | 严重程度 | 建议解决时间 | 状态 |
|-------|------|---------|---------|------------|------|
| TD001 | [简要描述] | [影响的模块/功能] | [高/中/低] | [时间评估] | [未解决/已规划/已解决] |
| ... | ... | ... | ... | ... | ... |

## 详细描述

### TD001: [债务标题]

**问题描述**：
[详细描述问题的本质和原因]

**当前解决方案**：
[描述当前的临时解决方案]

**理想解决方案**：
[描述最佳的解决方案]

**解决影响**：
[解决此问题可能带来的好处]

**所需资源**：
[解决此问题需要的资源和时间]

**相关代码位置**：
[具体的代码文件和行号]
```

### 5.3 知识传递文档

每个开发会话结束时，必须创建知识传递文档，存放在`知识传递`目录下，命名格式为`[任务代号]-知识传递.md`，内容包括：

1. **背景知识**: 开发过程中获取的领域知识和背景信息
2. **关键决策**: 做出的重要技术决策及原因
3. **学习经验**: 开发过程中的经验教训
4. **隐藏细节**: 容易被忽视的实现细节
5. **潜在问题**: 可能存在的问题和风险
6. **改进建议**: 对未来开发的建议

### 5.4 用户文档

对于面向用户的功能，必须创建用户文档，存放在`用户文档`目录下，命名格式为`[功能名称]-用户指南.md`，内容包括：

1. **功能概述**: 功能的用途和价值
2. **使用方法**: 详细的操作步骤
3. **界面说明**: 界面元素的功能说明
4. **常见问题**: 常见问题及解决方法
5. **最佳实践**: 功能的最佳使用方法
6. **限制说明**: 功能的限制和注意事项

### 5.5 会话总结与交接

每个开发会话结束时，必须创建会话总结文档，存放在`会话记录`目录下，命名格式为`[任务代号]-会话总结.md`，内容包括：

```markdown
# [任务代号]: [任务名称] 会话总结

## 基本信息
- **会话ID**: [会话ID]
- **日期**: [日期]
- **开发目标**: [本次会话的目标]
- **完成状态**: [完全完成/部分完成/未完成]

## 完成内容
[详细描述本次会话完成的内容]

## 遇到的问题与解决方案
[描述遇到的主要问题及解决方法]

## 技术决策
[记录本次会话做出的重要技术决策]

## 未完成工作
[描述未完成的工作及原因]

## 下一步建议
[对下一个会话的工作建议]

## 附加资源
[相关的文档、代码或其他资源链接]
```

每个会话总结必须在会话结束前由用户确认，确保准确性和完整性。

## 6. 质量管控与审查

质量管控贯穿整个开发生命周期，确保每个开发阶段都达到必要的质量标准。

### 6.1 质量检查点

在开发流程中设置以下关键质量检查点：

| 检查点 | 触发条件 | 检查内容 | 通过标准 |
|-------|---------|---------|---------|
| CP1 | 开发计划完成后 | 计划完整性和合理性 | 功能点分解合理，风险预估充分 |
| CP2 | 每个功能点完成后 | 功能实现质量 | 代码规范、测试通过、文档完整 |
| CP3 | 所有功能点完成后 | 整体功能质量 | 集成测试通过、性能达标 |
| CP4 | 文档完成后 | 文档质量和完整性 | 文档覆盖所有方面，内容准确完整 |

### 6.2 代码审查标准

代码审查必须关注以下方面：

1. **功能完整性**: 代码是否实现了所有需求
2. **代码质量**: 是否符合编码规范和最佳实践
3. **可维护性**: 结构是否清晰，命名是否合理
4. **性能考虑**: 是否有性能优化的空间
5. **安全性**: 是否存在安全隐患
6. **错误处理**: 是否有完整的错误处理
7. **兼容性**: 是否考虑了兼容性问题
8. **测试覆盖**: 测试是否覆盖所有关键路径

### 6.3 质量指标与度量

必须跟踪以下质量指标：

| 指标类别 | 具体指标 | 目标值 | 测量方法 |
|---------|---------|-------|---------|
| 代码质量 | 代码规范符合率 | 100% | 代码审查 |
| 测试覆盖 | 功能测试覆盖率 | ≥95% | 测试覆盖分析 |
| 性能指标 | 页面加载时间 | ≤1.5秒 | 性能测试 |
| 稳定性 | 崩溃率 | ≤0.1% | 稳定性测试 |
| 文档完整性 | 文档覆盖率 | 100% | 文档审查 |

### 6.4 发布标准

功能发布必须满足以下标准：

1. 所有功能点测试全部通过
2. 没有严重或高优先级的未解决问题
3. 性能指标达到预定目标
4. 所有必要文档已完成
5. 代码审查通过
6. 用户体验评估通过

## 7. 持续改进机制

### 7.1 经验教训收集

每个开发周期结束后，必须进行经验教训总结，包括：

1. **成功经验**: 哪些做法是有效的
2. **问题分析**: 遇到了哪些问题，原因是什么
3. **改进建议**: 如何改进开发流程和方法
4. **工具评估**: 使用的工具是否高效

### 7.2 流程优化

根据经验教训，定期优化开发流程：

1. 调整文档模板使其更高效
2. 改进测试方法提高测试效率
3. 优化代码审查流程
4. 更新技术栈和工具

### 7.3 知识库建设

将有价值的经验和解决方案添加到知识库中：

1. 常见问题及解决方案
2. 最佳实践和设计模式
3. 技术调研成果
4. 性能优化技巧

## 结语

本规范旨在为AI助手提供一个严格、规范的软件开发流程，确保开发质量和效率。随着项目的进展，本规范将不断改进和完善。所有参与开发的AI助手必须严格遵循本规范，确保开发过程的一致性和产品的高质量。

---

最后更新日期: 2024年4月
版本: 1.0 