
# 应用交互设计技术文档2.0（含小程序端）

| **类别**             | **内容**                                                                                      |
| -------------------------- | --------------------------------------------------------------------------------------------------- |
| **目标**             | 让用户每一次操作都像谈恋爱般丝滑流畅，60fps为基准，覆盖手机、电脑和小程序端。                       |
|                            | 手机含2017年后2000元以下安卓机，电脑含高端MacBook Pro和低端i5-7200U+4GB内存Windows机。              |
|                            | 兼容老旧浏览器（IE11、Chrome 60）和微信小程序客户端（安卓/iOS）。                                   |
| **适用设备与浏览器** | 手机：高端（2025年旗舰如华为P60）、低端（荣耀8X，小米6X，4核CPU、2-3GB内存、720p屏）。              |
|                            | 电脑：高端（MacBook Pro M2，16GB内存）、低端（2017年Windows，i5-7200U+4GB+机械硬盘）。              |
|                            | 浏览器：现代（Chrome 120、Safari 18）、老旧（IE11、Chrome 60）。                                    |
|                            | 小程序：微信客户端（安卓/iOS），网页版微信扫码进入。                                                |
| **高效渲染**         | 60fps实现：网页用 `requestAnimationFrame`，小程序用 `wx.createAnimation`，每帧16.6ms完成。      |
|                            | 硬件加速：网页用 `transform`和 `opacity`，小程序用 `<view animation="{{animationData}}">`。   |
|                            | 低端适配：检测CPU核心数（`navigator.hardwareConcurrency`或 `wx.getSystemInfo`）。               |
|                            | 若≤4或老旧浏览器/低端机，降到30fps，禁用复杂阴影。                                                 |
|                            | 具体例子：小程序滑动菜单用 `animation.translateX(100).step()`，IE11用 `left`降级。              |
|                            | 额外细节：长列表用Canvas（网页）或小程序 `<scroll-view>`+虚拟滚动，只渲染可视区域。               |
| **异步加载与懒加载** | 首屏优化：关键HTML/WXML同步加载，非关键图片/视频用懒加载技术。                                      |
|                            | 网页用 `IntersectionObserver`，小程序用 `<image mode="widthFix" lazy-load>`（IE11用polyfill）。 |
|                            | 低端适配：网络差（`navigator.connection`或 `wx.getNetworkType`检测），显示占位符(<50KB)。       |
|                            | 具体实现：小程序 `<image src="{{imgSrc}}" lazy-load>`，JS监听到视口替换 `src`。                 |
|                            | 额外细节：小程序分包加载，`app.json`配 `"subPackages": [{"root": "pages/extra"}]`。             |
| **事件节流与防抖**   | 高频事件优化：滚动用节流（100ms），输入用防抖（300ms）。                                            |
|                            | 低端适配：CPU核心数≤4或老旧浏览器/小程序低端机，节流改200ms，防抖改500ms。                         |
|                            | 具体代码：`const throttle = (fn, wait) => { let timer; return () => { if (!timer) ...`            |
|                            | `timer = setTimeout(() => { fn(); timer = null; }, wait); } }; }`，IE11用 `setInterval`。       |
|                            | 额外细节：触摸/鼠标事件绑定 `requestAnimationFrame`，小程序用微信事件，小程序低端用降级。         |
| **轻量化UI框架**     | 框架选型：网页用Svelte（编译时生成原生JS），小程序用原生WXML/WXSS，省内存。                         |
|                            | 长列表优化：虚拟滚动（Virtual Scroll），1000条数据占内存<10MB。                                     |
|                            | 具体实现：网页 `<script> import { VirtualList } from 'svelte-virtual-list'; </script>`。          |
|                            | 小程序用 `<scroll-view>`+JS计算可视区域，IE11用 `position: absolute`模拟。                      |
|                            | 低端适配：内存<500MB（`performance.memory`或 `wx.getSystemInfo`），关闭次要动画。               |
| **触摸与鼠标反馈**   | 体验提升：点击按钮加0.1s淡入（`opacity: 0.8`到 `1`），手机/小程序用震动反馈。                   |
|                            | 网页用 `navigator.vibrate(10)`，小程序用 `wx.vibrateShort({ type: 'light' })`，10ms震动。       |
|                            | 电脑用 `scale(0.95)`模拟按压，低端机或IE11用 `background-color`变色反馈。                       |
|                            | 具体代码：`.btn { transition: opacity 0.1s, transform 0.1s; } .btn:active { opacity...`           |
|                            | `opacity: 0.8; transform: scale(0.95); }`，IE11用 `.btn:active { background: #ddd; }`。         |
| **性能监控**         | 实时检测：网页用 `Performance API`，小程序用 `wx.reportPerformance`监控帧率。                   |
|                            | 低于40fps记录日志，低端适配帧率<30fps（或IE11/小程序低端机）关闭背景动画。                          |
|                            | 提示“性能模式已开启”，小程序加 `wx.onMemoryWarning`监听内存告警。                               |
|                            | 具体实现：`let last = performance.now(); requestAnimationFrame(() => { let now = ...`             |
|                            | `now = performance.now(); if (now - last > 33) console.log('掉帧'); last = now; });`。            |
| **缓存策略**         | 资源缓存：网页用Service Worker，小程序用 `wx.setStorage`，`Cache-Control: max-age=604800`。     |
|                            | 数据缓存：网页用IndexedDB，小程序用 `wx.setStorageSync`，优先取缓存再请求。                       |
|                            | 低端适配：内存<1GB或机械硬盘/小程序低端机，缓存上限5MB，过期清理避免OOM。                           |
|                            | 具体代码：网页 `caches.open('v1').then(cache => cache.addAll(['style.css', 'app.js']));`。        |
|                            | 小程序 `wx.setStorage({ key: 'data', data: list })`，IE11用 `<link rel="preload">`预加载。      |
| **用户测试**         | 测试方案：5台低端手机（荣耀8X）、5台高端手机（华为P60）、5台低端电脑（i5-7200U+IE11）。             |
|                            | 5台高端电脑（MacBook+Chrome 120）、5个小程序实例（安卓/苹果微信客户端）。                           |
|                            | 记录滑动/加载/点击延迟，低端滑动延迟>200ms，减少计算量（关闭粒子效果）。                            |
|                            | 高端加特效，测试网络设为3G（Chrome DevTools或微信模拟），首屏<3s。                                  |
