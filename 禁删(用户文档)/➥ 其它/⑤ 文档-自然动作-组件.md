### 开发动作拆解表（完整版）

| **顺序** |       **自然动作**       |           **组件**           |                       **开发步骤**                       |               **数据流动**               |               **状态管理**               |              **错误处理**              |    **依赖组件**    |
| :------------: | :----------------------------: | :--------------------------------: | :------------------------------------------------------------: | :--------------------------------------------: | :---------------------------------------------: | :------------------------------------------: | :-----------------------: |
|      1.1      | 用户在应用任意页面点击拍照图标 |     拍照图标按钮 (PhotoButton)     |             开发按钮组件，约 100 行，触发弹窗逻辑             |          输入：无；输出：弹窗触发信号          |          初始：待点击；完成：弹窗触发          |                      无                      |            无            |
|      2.1      |  系统弹出照相机或相册选择界面  |          弹窗组件 (Modal)          |           开发弹窗基础组件，约 150 行，显示/隐藏逻辑           |     输入：弹窗触发信号；输出：界面选择数据     |             初始：隐藏；完成：显示             |                      无                      |        PhotoButton        |
|      3.1      |  系统弹出照相机或相册选择界面  |           选项卡 (Tabs)           |       开发选项卡组件，约 120 行，提供“照相机/相册”切换       |       输入：界面选择数据；输出：用户选项       |           初始：待选；完成：选项确认           |             无选项时默认“相册”             |           Modal           |
|      4.1      | 用户选择“相册”并进入相册界面 |     相册选择器 (GalleryPicker)     |   开发相册选择器，约 180 行，调用系统相册 API，显示图片列表   |       输入：用户选项；输出：图片列表数据       |          初始：加载中；完成：图片显示          |         相册权限拒绝时提示“请授权”         |           Tabs           |
|      5.1      |     用户挑选照片后点击确定     |      确定按钮 (ConfirmButton)      |       开发确定按钮，约 90 行，绑定选中照片数据，触发跳转       |     输入：图片列表数据；输出：选中图片数组     |          初始：待确认；完成：跳转触发          |         无选中时提示“请至少选一张”         |       GalleryPicker       |
|      6.1      |     系统跳转至文章编辑界面     |  文章编辑页面 (ArticleEditorPage)  |   开发页面框架，约 160 行，包含导航和基础布局，接收照片数据   |     输入：选中图片数组；输出：编辑页面数据     |          初始：加载中；完成：页面显示          |          数据为空时显示“加载失败”          |       ConfirmButton       |
|      7.1      | 所选照片以每行三张形式排列显示 |      照片网格组件 (PhotoGrid)      |  开发网格布局，约 140 行，支持每行三张动态排列，接收照片数据  |      输入：编辑页面数据；输出：网格 HTML      |          初始：待渲染；完成：网格显示          |           图片加载失败时显示占位图           |     ArticleEditorPage     |
|      8.1      |  用户选择“照相机”并点击拍照  |   照相机调用组件 (CameraInvoker)   |  开发照相机调用，约 130 行，调用系统相机 API，含单张/连拍切换  |       输入：用户选项；输出：相机触发信号       |          初始：待触发；完成：相机启动          |         相机权限拒绝时提示“请授权”         |           Tabs           |
|      9.1      | 系统调用默认或用户设定的照相机 |    设置项组件 (SettingsOption)    | 开发相机设置，约 110 行，存储用户相机偏好，提供默认/自定义选项 |       输入：相机触发信号；输出：相机配置       |          初始：待配置；完成：配置生效          |           配置无效时用系统默认相机           |       CameraInvoker       |
|      10.1      |     用户完成单张拍照并确认     |  单张拍照按钮 (SingleShotButton)  |        开发单张拍照按钮，约 100 行，触发拍照并返回数据        |       输入：相机配置；输出：单张图片数据       |          初始：待拍照；完成：图片返回          |           拍照失败时提示“请重试”           |      SettingsOption      |
| **顺序** |       **自然动作**       |           **组件**           |                       **开发步骤**                       |               **数据流动**               |               **状态管理**               |              **错误处理**              |    **依赖组件**    |
|                |                                |                                    |                                                                |                                                |                                                |                                              |                          |
|      11.1      | 用户点击麦克风图标启动语音输入 |       麦克风按钮 (MicButton)       |            开发麦克风按钮，约 120 行，触发语音界面            |          输入：无；输出：语音界面信号          |          初始：待点击；完成：界面显示          |                      无                      |     ArticleEditorPage     |
|      12.1      | 系统显示语音输入界面和声波动画 |    语音输入层 (VoiceInputLayer)    |         开发语音输入层，约 180 行，显示界面和声波动画         |      输入：语音界面信号；输出：界面 HTML      |             初始：隐藏；完成：显示             |                      无                      |         MicButton         |
|      12.2      | 系统显示语音输入界面和声波动画 |    语音输入层 (VoiceInputLayer)    |     开发语音采集，约 160 行，调用麦克风 API，实时捕获语音     |       输入：界面 HTML；输出：语音数据流       |  初始：待采集；进行中：采集中；完成：采集结束  |        麦克风权限拒绝时提示“请授权”        |  VoiceInputLayer (12.1)  |
|      13.1      |   系统将语音转为文字实时显示   |   语音转文字模块 (SpeechToText)   |    开发语音转文字，约 190 行，集成 AI API，输出文本到编辑区    |       输入：语音数据流；输出：文本字符串       |  初始：待转换；进行中：转换中；完成：文本显示  |        API 失败时提示“语音识别失败”        |  VoiceInputLayer (12.2)  |
|      14.1      |     用户点击修改错别字按钮     |  错别字修正按钮 (FixTyposButton)  |       开发错别字修正，约 140 行，触发 AI 修正并显示结果       |       输入：文本字符串；输出：修正后文本       |          初始：待修正；完成：修正完成          |         修正无变化时提示“无错别字”         |       SpeechToText       |
|      15.1      |     用户推送日记到单位首页     |  日记推送按钮 (ShareDiaryButton)  |    开发推送按钮，约 130 行，绑定日记数据，发送到管理员后台    |   输入：用户日记 ID；输出：日记数据包至后台   |  初始：未推送；进行中：推送中；完成：推送成功  |     日记 ID 无效时提示“请选择有效日记”     |     ArticleEditorPage     |
|      16.1      |   系统生成时间脉络网页供审核   |     时间线网页 (TimelinePage)     |        开发时间线网页，约 170 行，显示日记列表和复选框        |    输入：日记数据包；输出：时间线 HTML 数据    |         初始：加载中；完成：显示时间线         |         数据包为空时显示“暂无日记”         |     ShareDiaryButton     |
|      16.2      |   系统生成时间脉络网页供审核   |     时间线网页 (TimelinePage)     |         开发复选框交互，约 150 行，记录管理员勾选状态         | 输入：时间线 HTML 数据；输出：勾选日记 ID 数组 |  初始：未勾选；进行中：勾选中；完成：勾选完毕  |        无勾选时提示“请至少选择一项”        |    TimelinePage (16.1)    |
|      17.1      |   管理员勾选后推送给 AI 处理   |   AI 处理按钮 (AIProcessButton)   |     开发 AI 处理按钮，约 140 行，触发 AI API，接收勾选数据     |   输入：勾选日记 ID 数组；输出：AI 请求参数   | 初始：待处理；进行中：AI 处理中；完成：参数生成 | API 失败时重试 3 次，否则提示“AI 服务异常” |    TimelinePage (16.2)    |
|      18.1      |   AI 生成文章并返回网页预览   | AI 文章生成器 (AIArticleGenerator) |         开发文章生成，约 180 行，调用 AI API，生成初稿         |     输入：AI 请求参数；输出：文章初稿 JSON     |  初始：待生成；进行中：生成中；完成：生成成功  |     AI 返回空时提示“生成失败，请重试”     |      AIProcessButton      |
|      18.2      |   AI 生成文章并返回网页预览   | AI 文章生成器 (AIArticleGenerator) |    开发网页预览，约 160 行，渲染 AI 生成内容，支持编辑跳转    |  输入：文章初稿 JSON；输出：渲染后的网页 HTML  |          初始：待渲染；完成：渲染完成          |     JSON 格式错误时显示“预览数据无效”     | AIArticleGenerator (18.1) |

---

#### 数据流动说明

以下是几个复杂点的解释，帮你理清思路：

1. **10.1 到 11.1（拍照到语音输入）**：

   - **数据流动**：10.1 输出单张图片数据，存入 `ArticleEditorPage`，11.1 不直接依赖它，而是从页面状态触发语音输入，中间靠页面组件传递图片上下文。
   - **难点**：图片和语音是并行功能，数据流不直接连通，但页面状态需保持一致。
2. **12.2 到 13.1（语音采集到转文字）**：

   - **数据流动**：12.2 的语音数据流是实时音频流，13.1 把它转成文本，涉及流式处理，AI API 得支持流式输入，否则要缓冲处理。
   - **建议**：用 WebSocket 或分段上传，确保实时性。
3. **16.2 到 17.1（勾选到 AI 处理）**：

   - **数据流动**：16.2 输出勾选日记 ID 数组，17.1 转成 AI 请求参数，中间可能需要格式化（比如 JSON），确保 AI 能解析。
   - **难点**：如果日记内容复杂（含图片、文本），参数构造得考虑结构化。
4. **18.1 到 18.2（AI 生成到预览）**：

   - **数据流动**：18.1 的文章初稿 JSON 是核心，18.2 解析渲染成 HTML，JSON 结构得规范（比如标题、正文、图片 URL）。
   - **建议**：定义好 JSON Schema，方便调试。
