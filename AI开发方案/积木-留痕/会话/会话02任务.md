# 会话02任务：照片采集组件开发

> 本文档定义会话02需要完成的任务，主要是照片采集组件的开发和相机页面的集成。

## 任务概述

本次会话的目标是开发"写留痕"功能中的核心组件——照片采集组件(PhotoCapture)。该组件是实现"拍照即留痕"功能的入口，负责拍照、照片基础处理和管理。同时，基于此组件完成相机页面的集成与优化。

## 任务清单

- [ ] **T006: 照片采集组件开发**
  - [ ] 组件基础结构搭建
  - [ ] 拍照功能实现(单拍/连拍模式)
  - [ ] 照片预览与布局
  - [ ] 照片基础处理(压缩、水印)
  - [ ] 照片删除与恢复
  - [ ] 长按照片交互

- [ ] **T007: 相机页面集成**
  - [ ] 优化现有相机页面
  - [ ] 集成照片采集组件
  - [ ] 添加拍照反馈(声音/震动)
  - [ ] 实现拍照设置(闪光灯、切换摄像头)
  
- [ ] **附加任务: 加载组件开发**
  - [ ] 实现通用加载状态组件
  - [ ] 支持不同尺寸和样式

## 必读文档

以下是完成任务所需阅读的文档：

1. [项目清单](../项目清单.md) - 了解总体任务划分和组件关系
2. [组件开发规范](../组件开发规范.md) - 了解组件开发的标准
3. [PhotoCaptureComponent_开发计划.md](../../PhotoCaptureComponent_开发计划.md) - 照片采集组件的详细规划
4. [相机页面代码](../../miniprogram/pages/diary/camera/) - 了解现有相机页面实现

## 按需参考

1. [微信小程序相机API文档](https://developers.weixin.qq.com/miniprogram/dev/component/camera.html) - 官方相机组件文档
2. [微信小程序媒体API文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMedia.html) - 照片选择和处理API
3. [照片处理技术](../AI防失忆系统/专题知识点/照片处理技术.md) - 照片处理的技术参考

## 任务详细说明

### T006: 照片采集组件开发

创建一个通用的照片采集组件，实现以下功能：

#### 1. 组件基础结构

组件目录结构：
```
components/PhotoCapture/
├── index.js         # 组件逻辑
├── index.wxml       # 组件模板
├── index.wxss       # 组件样式
└── index.json       # 组件配置
```

组件需要包含以下属性：
```javascript
properties: {
  // 拍照模式：单拍/连拍
  mode: {
    type: String,
    value: 'single' // 'single'或'continuous'
  },
  // 最大照片数量
  maxCount: {
    type: Number,
    value: 9
  },
  // 照片布局方式
  layout: {
    type: String,
    value: 'grid' // 'grid'或'list'
  },
  // 是否添加水印
  addWatermark: {
    type: Boolean,
    value: true
  },
  // 是否允许编辑
  enableEdit: {
    type: Boolean,
    value: true
  }
}
```

#### 2. 拍照功能实现

- 调用系统相机拍照
- 支持单拍和连拍两种模式
- 照片数量控制和提示
- 通过`wx.chooseMedia`实现照片选择

#### 3. 照片预览与布局

- 实现网格布局展示照片
- 支持照片预览功能
- 优化照片加载体验

#### 4. 照片基础处理

- 照片压缩与大小优化
- 添加时间和位置水印
- 照片质量保证

#### 5. 照片删除与恢复

- 实现照片删除功能
- 支持30分钟内恢复已删除照片
- 添加确认删除提示

#### 6. 长按照片交互

- 实现长按照片放大显示
- 添加触觉反馈
- 支持长按后可进行进一步操作

### T007: 相机页面集成

优化现有相机页面并集成照片采集组件：

#### 1. 优化现有相机页面

- 改进相机页面的UI设计
- 增强用户操作体验
- 修复现有相机页面的问题

#### 2. 集成照片采集组件

- 将照片采集组件集成到相机页面
- 实现拍照后直接进入照片管理流程
- 合理处理页面间的数据传递

#### 3. 添加拍照反馈

- 实现拍照声音
- 添加拍照震动反馈
- 支持用户自定义反馈设置

#### 4. 实现拍照设置

- 闪光灯控制(开启/关闭/自动)
- 前后摄像头切换
- 拍照倒计时功能

### 附加任务: 加载组件开发

创建一个通用的加载状态组件，以支持各种加载场景：

- 实现不同样式的加载动画
- 支持自定义加载提示文字
- 适配不同尺寸和场景

## 完成标准

1. 照片采集组件功能完整，符合需求
2. 相机页面集成良好，用户体验流畅
3. 代码符合项目编码规范
4. 组件有完整的文档说明
5. 组件性能良好，操作流畅
6. 组件有必要的错误处理机制

## 输出物

1. PhotoCapture组件代码
2. 优化后的相机页面代码
3. 加载组件代码(可选)
4. 组件使用文档和示例

## 注意事项

1. 严格遵循微信小程序开发规范
2. 注意相机权限的处理
3. 照片处理时注意性能优化，特别是大图片
4. 照片存储考虑小程序的存储限制
5. 完成后及时更新项目清单状态

## 技术参考

### 相机API示例

```javascript
// 拍照示例
const ctx = wx.createCameraContext();
ctx.takePhoto({
  quality: 'high',
  success: (res) => {
    const tempImagePath = res.tempImagePath;
    // 处理照片...
  },
  fail: (err) => {
    console.error('拍照失败:', err);
  }
});
```

### 照片选择API示例

```javascript
wx.chooseMedia({
  count: 9,
  mediaType: ['image'],
  sourceType: ['album', 'camera'],
  success: (res) => {
    const tempFiles = res.tempFiles;
    // 处理选择的照片...
  }
});
```

## 最后更新

- 文档创建时间: 2023-04-05
- 最后更新时间: 2023-04-05 