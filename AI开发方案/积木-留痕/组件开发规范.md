# 组件开发规范

> 本文档定义了"写留痕"功能开发中的组件规范，确保所有组件遵循统一的设计和实现标准。

## 基本原则

1. **独立性**: 每个组件应该尽可能独立，减少对其他组件的依赖
2. **可测试性**: 所有组件必须可独立测试
3. **可重用性**: 组件设计应考虑复用场景
4. **一致性**: 组件的API和行为模式应保持一致
5. **性能优先**: 在满足功能的前提下优先考虑性能

## 目录结构规范

每个组件应遵循以下目录结构：

```
components/ComponentName/
├── index.js         # 组件逻辑
├── index.wxml       # 组件模板
├── index.wxss       # 组件样式
├── index.json       # 组件配置
└── README.md        # 组件文档（可选）
```

特殊情况下，复杂组件可以包含子组件：

```
components/ComplexComponent/
├── index.js
├── index.wxml
├── index.wxss
├── index.json
├── components/      # 内部子组件目录
│   └── SubComponent/
│       ├── index.js
│       ├── index.wxml
│       ├── index.wxss
│       └── index.json
└── README.md
```

## 命名规范

### 文件命名

- 组件目录使用大驼峰命名法: `PhotoCapture`
- 工具类文件使用小驼峰命名法: `fileUtils.js`
- 样式文件使用短横线连接: `button-styles.wxss`

### 变量命名

- 变量和函数使用小驼峰命名法: `getUserInfo`
- 常量使用全大写加下划线: `MAX_FILE_SIZE`
- 私有方法和变量以下划线开头: `_processData`

### CSS类命名

- 使用BEM命名规范: 
  - 块: `.photo-card`
  - 元素: `.photo-card__image`
  - 修饰符: `.photo-card--selected`

## 接口设计规范

### 组件属性 (properties)

- 必须提供详细的类型、默认值和说明
- 属性名应符合其功能，避免歧义
- 使用observer处理属性变化

示例:

```javascript
properties: {
  // 照片数组
  images: {
    type: Array,
    value: [],
    observer: '_onImagesChange'
  },
  // 最大允许照片数
  maxCount: {
    type: Number,
    value: 9
  },
  // 布局方式: grid, list
  layout: {
    type: String,
    value: 'grid'
  }
}
```

### 组件方法 (methods)

- 公开方法不使用下划线前缀
- 私有方法使用下划线前缀
- 方法命名应具有描述性，表明其功能

示例:

```javascript
methods: {
  // 公开方法：添加照片
  addPhoto(photoPath) {
    // 实现逻辑
  },
  
  // 公开方法：删除照片
  removePhoto(index) {
    // 实现逻辑
  },
  
  // 私有方法：处理照片数据
  _processPhotoData(photo) {
    // 实现逻辑
  }
}
```

### 组件事件 (events)

- 事件名使用小驼峰并清晰表达含义
- 事件数据结构应保持一致性
- 事件应包含必要的上下文信息

示例:

```javascript
// 触发照片选择事件
this.triggerEvent('photoSelect', {
  index: photoIndex,
  photo: this.data.photos[photoIndex],
  timestamp: Date.now()
});
```

## 样式规范

- 使用项目预定义的变量而非硬编码值
- 避免使用!important
- 避免过度特异性选择器
- 组件样式应尽量独立，避免泄露

使用示例:

```css
.photo-grid {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
}

.photo-grid__item {
  width: calc((100% - var(--spacing-sm) * 2) / 3);
  aspect-ratio: 1;
  border-radius: var(--border-radius-md);
  overflow: hidden;
}

.photo-grid__item--selected {
  border: var(--border-width-medium) solid var(--color-brand-primary);
}
```

## 性能优化规范

### 数据处理

- 避免频繁调用 `setData`
- 只更新需要更新的数据
- 使用 `nextTick` 合并多次 `setData`

### 渲染优化

- 使用合理的条件渲染 (`wx:if` vs `hidden`)
- 列表渲染使用虚拟列表或分页
- 避免不必要的重渲染

### 资源管理

- 图片使用适当格式并压缩
- 延迟加载非关键资源
- 合理使用缓存机制

## 文档规范

每个组件应提供以下文档内容：

1. **组件概述**: 简单描述组件功能和使用场景
2. **属性列表**: 所有可配置属性及其说明
3. **方法列表**: 公开方法的说明和参数
4. **事件列表**: 所有触发事件的说明和数据结构
5. **使用示例**: 基本用法示例代码
6. **注意事项**: 使用中的特殊考虑或限制

## 测试规范

- 每个组件应有自测代码
- 测试用例应覆盖组件所有功能点
- 考虑边界条件和异常情况
- 测试方法与组件方法一一对应

## 版本控制

- 组件重大变更时记录修改日志
- 遵循语义化版本规范
- 保持向下兼容性

## 开发流程

1. 规划组件API和行为
2. 创建组件文件结构
3. 实现基础功能
4. 编写单元测试
5. 优化和完善
6. 文档化组件
7. 提交代码并更新状态

## 最后更新

- 文档创建时间: 2023-04-05
- 最后更新时间: 2023-04-05 