# 技术选型说明

> 本文档说明"写留痕"功能的技术选型和架构决策，为开发提供技术基础。

## 框架基础

### 微信小程序原生框架

选择原因:
- 直接访问微信小程序底层API，无额外封装层性能损耗
- 避免第三方框架可能带来的兼容性问题
- 文档完善，社区支持度高
- 满足业务需求的同时保持较小的包体积

注意事项:
- 需遵循微信小程序的开发规范
- 基于ES5语法进行开发，避免使用高级ES6+特性
- 使用微信开发者工具的"ES6转ES5"功能

### TypeScript (选用)

选择原因:
- 提供类型检查，减少运行时错误
- 增强代码可维护性和IDE智能提示
- 有助于规模化开发和团队协作

注意事项:
- 需确保TypeScript编译后的代码兼容微信小程序
- 需配置好tsconfig.json文件
- 确保编译过程不会删除.js文件

## UI框架

### 自定义设计系统

选择原因:
- 提供统一的设计语言和视觉风格
- 满足产品特定需求，定制化程度高
- 完全控制组件行为和性能优化

实现方式:
- 基于CSS变量实现主题和样式统一
- 组件化开发，高复用性
- 使用BEM命名规范保持样式隔离

## 状态管理

### 发布订阅模式

选择原因:
- 轻量级实现，适合小型到中型应用
- 组件间解耦，便于独立开发和测试
- 符合微信小程序的开发模式

实现方式:
- 自定义事件总线 (EventBus)
- 使用微信小程序的 globalData 配合发布订阅模式
- 组件级别状态保持在组件内部

## 数据存储

### 本地存储 + 云存储

选择原因:
- 支持离线操作，提升用户体验
- 云端同步确保数据安全和多设备一致性
- 合理分离本地/云端数据，优化性能和体验

实现技术:
- 本地: wx.setStorageSync/wx.getStorageSync
- 云端: 云开发数据库或自建服务端API
- 同步策略: 增量同步 + 冲突解决机制

## 网络请求

### Promise封装

选择原因:
- 更优雅的异步处理方式
- 便于请求拦截和统一处理
- 适合链式调用处理多步骤请求

实现方式:
- 封装wx.request为Promise形式
- 添加请求/响应拦截器
- 统一错误处理和重试机制

## 图片处理

### 微信小程序原生API + 自定义处理

选择原因:
- 利用微信原生组件的性能优势
- 自定义处理满足特定业务需求
- 避免引入大型第三方库增加包体积

关键API:
- wx.chooseMedia: 选择/拍摄图片
- wx.compressImage: 图片压缩
- wx.getImageInfo: 获取图片信息
- canvas: 图片编辑和水印添加

## 位置服务

### 微信地图组件 + 地理编码API

选择原因:
- 与微信生态深度集成
- 用户授权流程简单
- 定位精度和性能表现良好

关键API:
- wx.getLocation: 获取当前位置
- wx.chooseLocation: 选择位置
- map组件: 显示地图

## 语音识别

### 微信语音识别API

选择原因:
- 直接集成微信能力，无需额外服务
- 识别质量较好，满足基本需求
- 用户体验流畅，无额外授权要求

关键API:
- wx.startRecord: 开始录音
- wx.stopRecord: 结束录音
- 微信同声传译插件 (可选)

## 离线策略

### 队列 + 状态标记

选择原因:
- 支持完全离线环境下的功能使用
- 数据恢复机制确保用户数据安全
- 离线转在线平滑过渡，无感知同步

实现方式:
- 操作队列记录所有待同步操作
- 数据状态标记(未同步/已同步/同步失败)
- 网络恢复自动执行同步队列

## 测试方案

### 单元测试 + 模拟器测试 + 真机测试

选择原因:
- 全方位测试覆盖，确保功能稳定性
- 及早发现问题，降低修复成本
- 性能和兼容性问题早期暴露

实现技术:
- Jest: 单元测试框架
- 微信开发者工具自带模拟器
- 多设备真机测试矩阵

## 构建与部署

### 微信开发者工具 + 自动化脚本

选择原因:
- 符合微信小程序官方推荐的开发流程
- 自动化提高开发效率
- 确保部署过程可靠性

工具:
- 微信开发者工具命令行
- npm scripts 自动化任务
- 版本控制与标记

## 性能考量

### 核心优化策略

- 延迟加载非关键资源
- 合理使用分包加载
- 图片资源优化(压缩、缓存)
- setData优化(路径精确、合并调用)
- 合理使用缓存策略
- 预加载关键页面

## 第三方服务/库

| 服务/库名称 | 用途 | 选择理由 |
|------------|-----|---------|
| iconfont | 图标库 | 丰富的图标资源，支持按需加载 |
| dayjs | 日期处理 | 轻量级，体积小，API友好 |
| crypto-js | 加密库 | 安全性高，支持多种加密算法 |

## 技术决策过程

每个技术选择都经过以下考量:
1. 是否满足功能需求
2. 是否符合微信小程序的技术限制
3. 性能和资源消耗评估
4. 开发效率和可维护性
5. 兼容性和稳定性考虑

## 最后更新

- 文档创建时间: 2023-04-05
- 最后更新时间: 2023-04-05 