# 项目决策记录

## 2023-10-18

### 1. 相机组件封装策略

**背景**：需要实现照片采集功能，需要选择合适的相机组件实现方式。

**方案对比**：
- 方案1：直接使用微信原生camera组件
  - 优点：性能好，接口简单
  - 缺点：需要在每个页面重复处理权限和错误逻辑
  
- 方案2：封装camera-manager自定义组件
  - 优点：统一处理权限和错误，提高代码复用性
  - 缺点：增加一层抽象，调试略复杂
  
- 方案3：使用第三方相机组件
  - 优点：可能提供更多高级功能
  - 缺点：依赖外部代码，可能存在兼容性问题

**决策**：选择方案2，封装camera-manager自定义组件。

**原因**：
1. 提高代码复用性，避免在多个页面重复实现相同逻辑
2. 统一处理相机权限和错误处理，提升用户体验
3. 可自由扩展功能，不受第三方组件限制
4. 符合模块化和组件化开发理念

**实施者**：AI开发团队

**状态**：已实施

---

### 2. 照片预览交互方式选择

**背景**：用户拍摄多张照片后，需要提供预览和管理功能。

**方案对比**：
- 方案1：使用swiper组件实现滑动预览
  - 优点：原生组件，性能好，滑动体验佳
  - 缺点：自定义样式受一定限制
  
- 方案2：自定义实现预览组件
  - 优点：完全自定义，可实现复杂动效
  - 缺点：实现复杂，需自行处理手势
  
- 方案3：使用缩略图列表+单图查看
  - 优点：实现简单，交互直观
  - 缺点：预览体验较差，操作步骤多

**决策**：选择方案1，使用swiper组件实现滑动预览。

**原因**：
1. 原生组件性能优秀，滑动流畅
2. 符合大多数用户的使用习惯
3. 开发效率高，可快速实现
4. 可通过自定义样式满足基本设计需求

**实施者**：AI开发团队

**状态**：已实施

---

### 3. 照片存储策略选择

**背景**：照片拍摄后需要存储以供预览和使用，需要选择合适的存储方式。

**方案对比**：
- 方案1：仅内存中临时存储
  - 优点：速度最快，使用简单
  - 缺点：重启应用后丢失，内存占用大
  
- 方案2：本地存储+临时路径
  - 优点：性能好，可持久化，应用重启后可恢复
  - 缺点：需要管理临时文件，存储空间有限
  
- 方案3：立即上传至云存储
  - 优点：节省本地空间，数据更安全
  - 缺点：依赖网络，体验受网络影响大

**决策**：选择方案2，本地存储+临时路径。

**原因**：
1. 平衡了性能和可靠性
2. 用户拍照后可立即预览，不受网络影响
3. 应用重启后可恢复已拍摄的照片
4. 后续可选择合适时机上传至云端

**实施者**：AI开发团队

**状态**：已实施

---

### 4. UI风格确定

**背景**：需要确定照片采集页面的UI风格，以提供良好的用户体验。

**方案对比**：
- 方案1：传统相机风格（亮色系）
  - 优点：界面清晰，元素易识别
  - 缺点：在强光环境下可能影响取景
  
- 方案2：专业相机风格（暗色系）
  - 优点：减少对取景的干扰，突出拍摄内容
  - 缺点：在暗光环境下按钮可能不易辨识
  
- 方案3：自适应风格（根据环境切换）
  - 优点：兼顾各种环境的使用体验
  - 缺点：实现复杂，需要光线传感

**决策**：选择方案2，使用暗色系专业相机风格。

**原因**：
1. 暗色系界面可减少对取景的干扰
2. 提供更专业的拍摄体验
3. 与大多数专业相机应用一致，符合用户习惯
4. 可通过UI设计确保按钮在暗光环境下仍清晰可见

**实施者**：AI开发团队

**状态**：已实施

---

## 2023-10-19（预定）

### 5. 照片压缩策略选择

**背景**：相机拍摄的原始照片通常较大，需要确定合适的压缩策略。

**方案对比**：
- 方案1：原图存储，使用时压缩
  - 优点：保留最高质量，灵活控制压缩
  - 缺点：存储空间占用大，处理时可能卡顿
  
- 方案2：拍摄时直接压缩
  - 优点：节省存储空间，后续处理更快
  - 缺点：无法恢复原图质量
  
- 方案3：云端动态压缩
  - 优点：客户端负担小，可按需生成不同质量
  - 缺点：依赖网络，增加传输成本

**决策**：待定，需进一步评估。

**需考虑因素**：
1. 目标用户设备性能水平
2. 照片用途对质量的要求
3. 网络环境假设
4. 存储空间限制

**实施者**：AI开发团队

**状态**：评估中

---

## 2024-04-06 云开发接入决策

决定接入微信小程序云开发功能，主要考量点如下：

1. **优势**
   - 无需自建服务器，降低运维难度
   - 微信官方提供的服务，稳定可靠
   - 天然支持用户身份鉴权，简化开发流程
   - 支持云函数、云数据库和云存储三大核心能力

2. **实现方案**
   - 创建云函数目录结构，提供4个核心云函数
     - `getOpenId`: 获取用户的OpenID
     - `initDatabase`: 初始化数据库集合结构
     - `manageUser`: 用户信息管理（查询、创建、更新）
     - `manageFile`: 文件信息管理（上传、下载、查询、删除）
   - 设计并创建6个数据库集合
     - `users`: 用户信息集合
     - `photos`: 照片文件集合
     - `diaries`: 日记集合
     - `traces`: 轨迹记录集合
     - `settings`: 应用设置集合
     - `feedback`: 用户反馈集合
   - 封装CloudService服务，统一管理云开发API调用
   - 提供云开发测试页面，验证各项功能
   - 优化云存储目录结构，按用户ID隔离

3. **环境配置**
   - 云环境ID: `xiuhuazhenMiniProGram`
   - 初始化在app.js中完成
   - 服务已通过服务容器进行注册

4. **数据隔离与安全**
   - 云存储采用以用户ID为前缀的目录结构
   - 云函数自动获取用户OpenID，保证数据隔离
   - 采用软删除策略，防止数据误删除

5. **后续规划**
   - 针对具体业务场景开发专用云函数
   - 优化数据库索引提高查询效率
   - 增加云函数定时触发器实现自动化任务

最后更新时间: 2023-10-18 