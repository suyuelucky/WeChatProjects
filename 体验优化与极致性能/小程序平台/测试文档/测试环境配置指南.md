# 测试环境配置指南

## 1. 基本原则

测试环境的建设和管理应遵循以下基本原则：

- **隔离性**：测试环境应与生产环境完全隔离，避免测试活动对生产环境造成干扰
- **一致性**：测试环境应尽可能模拟生产环境的配置和特性，确保测试结果的有效性
- **稳定性**：测试环境应保持稳定，避免频繁变更导致测试结果不可靠
- **可管理性**：测试环境应具备完善的管理机制，包括版本控制、配置管理等
- **安全性**：测试环境的安全防护措施应到位，尤其是涉及敏感数据的测试
- **可扩展性**：测试环境应能够根据测试需求进行灵活扩展
- **可监控性**：测试环境应配备必要的监控工具，及时发现和解决问题

## 2. 测试环境分类

为保证测试全面性和有效性，应建立以下几类测试环境：

### 2.1 开发测试环境

- **用途**：供开发人员进行单元测试和基本功能测试
- **特点**：配置简单，更新频繁，主要用于验证代码逻辑
- **部署方式**：本地部署，开发者工具模拟器运行

### 2.2 集成测试环境

- **用途**：用于验证各模块间接口交互和业务流程
- **特点**：包含所有模块，配置与生产环境接近
- **部署方式**：统一服务器部署，可通过内网访问

### 2.3 性能测试环境

- **用途**：专门用于性能测试，包括压力测试、负载测试等
- **特点**：硬件配置与生产环境相同或接近，数据量可控
- **部署方式**：独立服务器部署，避免与其他环境相互干扰

### 2.4 用户体验测试环境

- **用途**：用于验证用户界面和交互体验
- **特点**：配置多样化，覆盖各类终端设备和操作系统
- **部署方式**：多设备部署，包括真机和模拟器

### 2.5 预发布环境

- **用途**：模拟生产环境，进行最终验收测试
- **特点**：配置与生产环境完全一致，数据结构一致但脱敏
- **部署方式**：与生产环境相同架构部署

## 3. 设备配置标准

为确保测试覆盖率和有效性，测试设备应满足以下配置标准：

### 3.1 移动设备标准配置

#### 低端设备配置
- **处理器**：四核及以下，主频1.5GHz以下
- **内存**：2GB及以下
- **存储**：16GB及以下
- **系统**：Android 8.0以下或iOS 11以下
- **网络**：仅支持4G及以下网络

#### 中端设备配置
- **处理器**：四核至八核，主频1.5GHz-2.3GHz
- **内存**：3GB-6GB
- **存储**：32GB-64GB
- **系统**：Android 8.0-10.0或iOS 11-13
- **网络**：支持4G/5G网络

#### 高端设备配置
- **处理器**：八核及以上，主频2.3GHz以上
- **内存**：6GB以上
- **存储**：128GB及以上
- **系统**：Android 10.0以上或iOS 13以上
- **网络**：全面支持5G网络

### 3.2 测试机型覆盖范围

测试设备选择应遵循"二八原则"，优先覆盖市场占有率较高的机型：

1. **必测机型**（覆盖市场份额前30%）：
   - iPhone 14系列、iPhone 13系列
   - 华为Mate系列、P系列最新两代产品
   - 小米/红米中高端热销机型
   - OPPO/vivo中高端热销机型

2. **常规测试机型**（覆盖市场份额30%-80%）：
   - iPhone较早系列（iPhone 11/12系列）
   - 中端主流Android机型
   - 平板设备（iPad Pro/Air、华为MatePad等）

3. **抽样测试机型**（覆盖市场份额剩余20%）：
   - 低端入门机型
   - 较早期系统版本设备
   - 特殊尺寸/分辨率设备

## 4. 测试工具配置

## 5. 环境搭建流程

## 6. 环境管理规范

## 7. 安全措施

## 8. 附录

## 4. 网络环境模拟

为全面评估小程序在各种网络条件下的表现，应模拟以下网络环境：

### 4.1 网络类型模拟

| 网络类型 | 下载速度 | 上传速度 | 延迟(ms) | 丢包率(%) |
|---------|--------|---------|--------|---------|
| 5G     | 100Mbps以上 | 50Mbps以上 | 10-30  | 0-0.1   |
| 4G     | 10-30Mbps  | 5-15Mbps   | 50-100 | 0-0.5   |
| 3G     | 1-5Mbps    | 0.5-2Mbps  | 100-200| 0.5-1   |
| 2G     | 100-500Kbps| 50-200Kbps | 300-500| 1-2     |
| WiFi高速| 50Mbps以上 | 20Mbps以上 | 10-30  | 0-0.1   |
| WiFi一般| 10-30Mbps  | 5-10Mbps   | 30-80  | 0.1-0.5 |
| WiFi弱信号| 1-5Mbps   | 0.5-2Mbps  | 80-150 | 0.5-2   |

### 4.2 特殊网络状况模拟

#### 不稳定网络
- **参数设置**：
  - 间歇性断连：每30-60秒断开5-10秒
  - 波动延迟：基础延迟上下浮动50-200ms
  - 随机丢包：基础丢包率上浮动0-5%

#### 弱网环境
- **参数设置**：
  - 下载速度：256Kbps-1Mbps
  - 上传速度：128Kbps-512Kbps
  - 延迟：200-500ms
  - 丢包率：2-5%

#### 网络切换
- 模拟WiFi与移动网络之间的切换
- 模拟不同移动网络制式间的切换（如4G切换到3G）
- 切换频率：每1-3分钟切换一次

### 4.3 网络模拟工具推荐

1. **Charles Proxy**: 适用于Mac/Windows，可进行带宽限制和延迟模拟
2. **Network Link Conditioner**: 适用于iOS/Mac设备，系统级网络条件模拟
3. **DevTools Network Throttling**: 微信开发者工具内置的网络节流功能
4. **Proxyman**: 适用于Mac，界面友好的代理工具
5. **Fiddler**: 适用于Windows，功能强大的代理调试工具

## 5. 测试数据准备

### 5.1 照片采集测试数据集

#### 基础照片样本库
- **样本数量**：不少于500张
- **分辨率梯度**：
  - 低分辨率：640×480、800×600
  - 中等分辨率：1280×720、1920×1080
  - 高分辨率：2560×1440、3840×2160及以上
- **文件格式**：JPG、PNG、WEBP
- **文件大小**：分为小（<500KB）、中（500KB-2MB）、大（>2MB）三个等级

#### 特殊场景照片
- 低光照环境照片（50张）
- 高对比度场景照片（50张）
- 复杂纹理背景照片（50张）
- 动态模糊照片（50张）
- 特殊色彩范围照片（如偏红、偏蓝等，50张）

#### 模拟真实用例照片集
- 工作留痕相关的实际场景照片（100张）
- 包含不同角度、光照条件的同一场景照片（50组，每组5张）

### 5.2 模拟用户操作数据

#### 用户操作脚本
- 快速连续拍摄脚本（10秒内拍摄5-10张）
- 拍摄-编辑-上传完整流程脚本
- 异常操作脚本（如拍摄中退出、权限中断等）

#### 批量测试数据生成器
```javascript
// 用于生成大量测试数据的辅助工具示例
function generateTestData(count, type) {
  const data = [];
  for (let i = 0; i < count; i++) {
    // 根据type生成不同类型的测试数据
    data.push({
      id: `test-${type}-${i}`,
      timestamp: Date.now() + i,
      // 其他属性...
    });
  }
  return data;
}
```

### 5.3 数据管理指南

#### 测试数据版本控制
- 使用语义化版本号（v1.0.0）
- 每个版本包含变更日志
- 建立基准测试数据集（Baseline）

#### 测试数据存储位置
- 内部测试服务器：`http://test-data.internal.example.com/photo-capture/`
- 备份位置：本地NAS `/volumes/test-data/photo-capture/`
- 云端备份：公司私有云 `s3://company-test-data/photo-capture/`

#### 数据隐私与安全
- 所有测试数据必须脱敏
- 禁止使用含有个人身份信息的照片
- 测试数据访问需经过权限验证

## 6. 测试环境隔离要求 