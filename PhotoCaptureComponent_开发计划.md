# 照片采集组件(PhotoCaptureComponent)开发计划

## 1. 组件概述

照片采集组件是实现"拍照即留痕"功能的核心入口，负责拍照、照片处理和布局展示，以及与后续语音识别模块的交互衔接。该组件将符合微信小程序开发规范，遵循项目设计系统和性能要求。

## 2. 功能需求

根据《用户需求拆解-写留痕-编辑页.md》文档中的3.1、3.2和3.3节内容，照片采集组件需实现以下功能：

### 2.1 快捷拍照机制
- 全局拍照入口（常驻图标）
- 单拍/连拍模式切换
- 支持调用系统相机或第三方相机
- 拍照反馈（声音/震动反馈，可定制）

### 2.2 照片智能处理
- 照片自动排列布局（网格形式）
- 自动生成两个版本照片（原始版本和带时间/位置的工作版本）
- 基础照片编辑功能（裁剪、旋转、亮度调整）
- 智能存储优化（自动压缩、本地与云端同步）
- 用完即删机制（优化性能和存储空间）

### 2.3 照片交互设计
- 长按照片交互（放大显示、触觉反馈、其他照片半透明化）
- 照片排序调整（拖拽功能）
- 删除操作（确认弹窗、30分钟内恢复功能）
- 封面图设置（最多三张）
- 照片合组功能（最多4张合为一组）

## 3. 技术架构

### 3.1 组件结构
```
miniprogram/components/PhotoCapture/
├── index.js             # 组件主逻辑
├── index.wxml           # 组件模板
├── index.wxss           # 组件样式
├── index.json           # 组件配置
└── README.md            # 组件说明
```

### 3.2 依赖服务
- 微信小程序API：camera、chooseMedia
- 项目工具库：
  - fileUploadUtils.js（照片上传和处理）
  - storageManager.js（照片存储管理）
  - networkUtils.js（网络状态检测）
  - apiService.js（与后端交互）

### 3.3 性能优化策略
- 图片懒加载机制
- 图片预处理和压缩
- 本地与云端智能同步
- 用完即删机制实现

## 4. API设计

### 4.1 组件属性(properties)
```javascript
properties: {
  mode: {                // 拍照模式
    type: String,        
    value: 'single'      // 'single'或'continuous'
  },
  maxImages: {           // 最大照片数量
    type: Number,
    value: 9
  },
  layout: {              // 布局方式
    type: String,
    value: 'grid'        // 'grid'或'list'或'slideshow'
  },
  addWatermark: {        // 是否添加水印（时间和位置）
    type: Boolean,
    value: true
  },
  enableEdit: {          // 是否启用编辑功能
    type: Boolean,
    value: true
  },
  enableGrouping: {      // 是否启用照片合组
    type: Boolean,
    value: true
  }
}
```

### 4.2 组件方法(methods)
```javascript
methods: {
  // 拍照
  takePhoto(),
  // 从相册选择
  chooseFromAlbum(),
  // 编辑照片
  editPhoto(index),
  // 删除照片
  deletePhoto(index),
  // 设置为封面
  setCover(index, isCover),
  // 照片分组
  groupPhotos(indices),
  // 调整照片顺序
  reorderPhotos(fromIndex, toIndex)
}
```

### 4.3 事件(events)
```javascript
// 照片列表更新事件
this.triggerEvent('imagesChange', { images: this.data.images });

// 长按照片事件（用于触发语音输入）
this.triggerEvent('imageLongpress', { 
  index: index, 
  image: this.data.images[index] 
});

// 照片加载完成事件
this.triggerEvent('imagesLoaded');
```

## 5. 开发步骤

1. **基础组件结构搭建**
   - 创建组件目录和基础文件
   - 实现组件基础配置

2. **拍照功能实现**
   - 实现单拍/连拍模式
   - 调用相机API
   - 添加拍照反馈

3. **照片展示与布局**
   - 实现网格布局
   - 实现照片预览功能
   - 实现长按照片交互

4. **照片处理功能**
   - 实现照片水印添加
   - 实现基础编辑功能
   - 实现照片压缩和存储优化

5. **照片交互功能**
   - 实现拖拽排序
   - 实现照片删除与恢复
   - 实现封面设置
   - 实现照片合组

6. **与其他组件的衔接**
   - 定义事件接口（特别是长按照片→语音输入的衔接）
   - 数据共享机制

## 6. 测试计划

1. **单元测试**
   - 测试各API接口
   - 测试组件事件触发

2. **集成测试**
   - 与语音识别组件集成测试
   - 与编辑器组件集成测试

3. **性能测试**
   - 照片加载速度测试
   - 内存占用测试
   - 低端设备适配测试

4. **兼容性测试**
   - iOS/Android平台测试
   - 不同屏幕尺寸测试

## 7. 风险与挑战

1. **照片处理性能**
   - 在低端设备上处理大量照片可能导致性能问题
   - 缓解策略：分批处理、延迟加载、优化图片大小

2. **离线功能**
   - 无网络环境下需保证照片采集和基础处理功能可用
   - 缓解策略：本地存储机制、离线队列、数据同步策略

3. **存储限制**
   - 微信小程序本地存储有限制
   - 缓解策略：及时上传云端、智能清理本地缓存

4. **用户体验一致性**
   - 不同设备上的相机性能和效果差异
   - 缓解策略：统一后处理、适配不同设备参数

## 8. 时间估计

| 任务 | 预计工时(小时) |
|------|--------------|
| 基础结构搭建 | 2 |
| 拍照功能实现 | 4 |
| 照片展示与布局 | 5 |
| 照片处理功能 | 6 |
| 照片交互功能 | 8 |
| 组件衔接 | 3 |
| 测试与调优 | 8 |
| **总计** | **36** |

## 9. 后续扩展计划

1. **AI智能识别**
   - 自动识别照片中的文字
   - 场景识别与标签生成

2. **照片批处理**
   - 批量添加水印
   - 批量调整参数

3. **高级编辑功能**
   - 滤镜系统
   - 标注工具增强

4. **云端AI处理**
   - 与云端AI服务对接
   - 智能内容分类与推荐 